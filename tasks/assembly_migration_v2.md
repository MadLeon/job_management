# æ–°ä»»åŠ¡è®¡åˆ’ï¼šå…ˆå¯¼å…¥ç¼ºå¤±é›¶ä»¶ï¼Œå†è¿ç§»assemblieså…³ç³»

**åˆ›å»ºæ—¥æœŸ**: 2026-01-09  
**ç›®æ ‡**: ä» jobs.db assemblies è¡¨ä¸­å¯¼å…¥ç¼ºå¤±çš„é›¶ä»¶åˆ° record.db part è¡¨ï¼Œç„¶åå†è¿ç§» assemblies å…³ç³»åˆ° part_tree

---

## ğŸ“Š å½“å‰çŠ¶å†µå›é¡¾

### part è¡¨ç°æœ‰æ•°æ®
- æ€»è®°å½•æ•°: 291
- å…¶ä¸­åŒ…å«çš„ assemblies ç›¸å…³:
  - æ€»è£…ä»¶: 49 ä¸ª
  - é›¶ä»¶: 16 ä¸ª
  - äº¤é›†: 5 ä¸ª

### assemblies è¡¨ä¸­çš„ç¼ºå¤±
- æ€»è£…ä»¶å·ä¸åœ¨ part ä¸­: 24 ä¸ª (å…¶ä¸­ 1 ä¸ªæ˜¯ç©ºå­—ç¬¦ä¸²)
- é›¶ä»¶å·ä¸åœ¨ part ä¸­: 1346 ä¸ª

---

## ğŸ”„ æ–°çš„è¿ç§»æµç¨‹ï¼ˆåˆ†ä¸¤é˜¶æ®µï¼‰

### ğŸ¯ ç¬¬ä¸€é˜¶æ®µï¼šè¡¥å……ç¼ºå¤±é›¶ä»¶

**ã€ç¬¬1æ­¥ã€‘åˆ†æç¼ºå¤±çš„é›¶ä»¶ä¿¡æ¯**
- [ ] ç»Ÿè®¡ä» assemblies ä¸­ç¼ºå¤±çš„æ€»è£…ä»¶å· (part_number)
- [ ] ç»Ÿè®¡ä» assemblies ä¸­ç¼ºå¤±çš„é›¶ä»¶å· (drawing_number)
- [ ] æ£€æŸ¥è¿™äº›é›¶ä»¶çš„é¢å¤–ä¿¡æ¯ï¼ˆdescriptionã€quantityç­‰ï¼‰

**éªŒè¯ç»“æœ**:
- part_number ä¸­å«æœ‰ `-GA-`: 68 ä¸ª
- part_number ä¸­ä¸å« `-GA-`: 5 ä¸ª
- drawing_number ä¸­å«æœ‰ `-GA-`: 158 ä¸ªï¼ˆè¿™äº›éœ€è¦æ ‡è®°ä¸º is_assembly=1ï¼‰
- drawing_number ä¸­ä¸å« `-GA-`: 1204 ä¸ªï¼ˆè¿™äº›æ ‡è®°ä¸º is_assembly=0ï¼‰

**ã€ç¬¬2æ­¥ã€‘åˆ›å»ºè¿ç§»è„šæœ¬** `007_import_missing_parts_from_assemblies.js`
- [ ] ä» assemblies ä¸­æå–å”¯ä¸€çš„ part_number å’Œ drawing_number
- [ ] æ£€æŸ¥å“ªäº›åœ¨ part è¡¨ä¸­ä¸å­˜åœ¨
- [ ] ä¸ºç¼ºå¤±çš„é›¶ä»¶åˆ›å»ºæ–°çš„ part è®°å½•
- [ ] è®¾ç½®åˆç†çš„é»˜è®¤å€¼ï¼š
  - `drawing_number`: æ¥è‡ª assemblies
  - `description`: æ¥è‡ª assemblies (æˆ– NULL)
  - `is_assembly`: å¯¹ part_number è®¾ä¸º 1ï¼ˆå› ä¸ºè¿™äº›æ˜¯æ€»è£…ä»¶ï¼‰ï¼›å¯¹ drawing_number è®¾ä¸º 0
  - `revision`: é»˜è®¤ä¸º '-'
  - å…¶ä»–å­—æ®µç”¨é»˜è®¤å€¼

**ã€ç¬¬3æ­¥ã€‘æµ‹è¯•å¯¼å…¥è„šæœ¬**
- [ ] åœ¨ä¸´æ—¶æ•°æ®åº“ä¸Šè¿è¡Œè¿ç§»
- [ ] éªŒè¯æ–°å¢çš„ part è®°å½•
- [ ] æ£€æŸ¥æ˜¯å¦æœ‰å†²çªï¼ˆUNIQUE çº¦æŸï¼‰

**ã€ç¬¬4æ­¥ã€‘æ‰§è¡Œå¯¼å…¥**
- [ ] è¿è¡Œ `npm run db:migrate` åº”ç”¨è¿ç§»
- [ ] éªŒè¯ part è¡¨æ–°å¢çš„è®°å½•æ•°

---

### ğŸ¯ ç¬¬äºŒé˜¶æ®µï¼šè¿ç§» assemblies å…³ç³»

**ã€ç¬¬5æ­¥ã€‘åˆ›å»ºè¿ç§»è„šæœ¬** `008_migrate_assemblies_to_part_tree.js`
- [ ] éå†æ‰€æœ‰ assemblies è®°å½•
- [ ] å¯¹æ¯æ¡è®°å½•ï¼š
  - æŸ¥è¯¢ part_number å¯¹åº”çš„ part.idï¼ˆä½œä¸º parent_idï¼‰
  - æŸ¥è¯¢ drawing_number å¯¹åº”çš„ part.idï¼ˆä½œä¸º child_idï¼‰
  - æ’å…¥åˆ° part_tree è¡¨
- [ ] å¤„ç†å¼‚å¸¸æƒ…å†µï¼š
  - è·³è¿‡è‡ªå¼•ç”¨ï¼ˆparent_id = child_idï¼‰
  - è·³è¿‡ä»ç„¶æ— æ³•åŒ¹é…çš„è®°å½•ï¼ˆç†è®ºä¸Šåº”è¯¥ä¸º 0ï¼‰
  - å¤„ç† quantity ä¸ºç©ºçš„æƒ…å†µï¼ˆé»˜è®¤ä¸º 1ï¼‰
  - å¤„ç†é‡å¤çš„ (parent_id, child_id) ç»„åˆï¼ˆUNIQUE çº¦æŸï¼‰

**ã€ç¬¬6æ­¥ã€‘æµ‹è¯• part_tree è¿ç§»**
- [ ] åœ¨ä¸´æ—¶æ•°æ®åº“ä¸Šè¿è¡Œè¿ç§»
- [ ] éªŒè¯ part_tree è¡¨æœ‰æ•°æ®
- [ ] æ£€æŸ¥å¤–é”®å®Œæ•´æ€§
- [ ] æŠ½æ ·éªŒè¯æ•°æ®å‡†ç¡®æ€§

**ã€ç¬¬7æ­¥ã€‘æ‰§è¡ŒçœŸå®è¿ç§»**
- [ ] è¿è¡Œ `npm run db:migrate` åº”ç”¨è¿ç§»

---

### âœ… ç¬¬ä¸‰é˜¶æ®µï¼šéªŒè¯å’Œæ¸…ç†

**ã€ç¬¬8æ­¥ã€‘å®Œæ•´éªŒè¯**
- [ ] æ£€æŸ¥ part_tree è®°å½•æ•°ï¼ˆåº”ä¸º 1499 æˆ–æ¥è¿‘ï¼‰
- [ ] æ£€æŸ¥æ˜¯å¦æœ‰å¤–é”®è¿è§„
- [ ] æ£€æŸ¥ UNIQUE çº¦æŸå†²çª
- [ ] é‡‡æ ·éªŒè¯æ•°æ®å‡†ç¡®æ€§

**ã€ç¬¬9æ­¥ã€‘æ›´æ–°æ–‡æ¡£**
- [ ] è®°å½•è¿ç§»ç»Ÿè®¡æ•°æ®
- [ ] æ›´æ–° session æ€»ç»“

---

## ğŸ’¡ å…³é”®å†³ç­–ç‚¹

### 1. part_tree çš„ UNIQUE çº¦æŸ
- **çº¦æŸ**: `UNIQUE(parent_id, child_id)`
- **å«ä¹‰**: åŒä¸€ä¸ªçˆ¶ä»¶ï¼ˆparent_idï¼‰ä¸èƒ½æœ‰é‡å¤çš„å­ä»¶ï¼ˆchild_idï¼‰
- **å†²çªå¤„ç†**: è‹¥ assemblies ä¸­æœ‰é‡å¤çš„ (parent, child) ç»„åˆ
  - æ–¹æ¡ˆ: ä½¿ç”¨æœ€å¤§çš„ quantity å€¼ï¼Œæˆ–ç›´æ¥è·³è¿‡
  - å½“å‰åˆ†æ: æ²¡æœ‰é‡å¤ç»„åˆï¼Œæ‰€ä»¥ä¸éœ€è¦æ‹…å¿ƒ

### 2. ç¼ºå¤±é›¶ä»¶çš„ is_assembly æ ‡è®° - é€šè¿‡ -GA- åˆ¤æ–­
- **è§„åˆ™**: 
  - **æ¥è‡ª part_number çš„é›¶ä»¶**: å…¨éƒ¨æ ‡è®°ä¸º `is_assembly = 1`ï¼ˆå› ä¸ºå®ƒä»¬éƒ½æ˜¯æ€»è£…ä»¶ï¼‰
  - **æ¥è‡ª drawing_number çš„é›¶ä»¶**: æ£€æŸ¥æ˜¯å¦åŒ…å« `-GA-` å­—ç¬¦ä¸²
    - åŒ…å« `-GA-`: `is_assembly = 1`ï¼ˆåˆ†è£…å›¾ï¼Œæœ‰è‡ªå·±çš„å­ä»¶ï¼‰
    - ä¸åŒ…å«: `is_assembly = 0`ï¼ˆæ™®é€šé›¶ä»¶ï¼‰
- **è¯´æ˜**: `-GA-` ä»£è¡¨ General Assemblyï¼ˆæ€»è£…å›¾ï¼‰ï¼Œæ ‡å¿—è¯¥é›¶ä»¶æœ‰æ›´æ·±ä¸€å±‚çš„çˆ¶å­å…³ç³»

### 3. å¤„ç†ç©ºçš„ quantity
- ç©ºå­—ç¬¦ä¸²æˆ– NULL: é»˜è®¤ä¸º `1`

### 4. ç¼ºå¤±é›¶ä»¶çš„å…¶ä»–å­—æ®µ
- `revision`: é»˜è®¤ '-'
- `production_count`: é»˜è®¤ 0
- `total_production_hour`: é»˜è®¤ 0.0
- `total_administrative_hour`: é»˜è®¤ 0.0
- `unit_price`: é»˜è®¤ 0.0

---

## ğŸ“‹ æ–°çš„ TODO åˆ—è¡¨

1. âœ… åˆ†æ assemblies æ•°æ®åˆ†å¸ƒ (å·²å®Œæˆ)
2. [ ] åˆ†æç¼ºå¤±çš„é›¶ä»¶å’Œæ€»è£…ä»¶
3. [ ] åˆ›å»ºè¿ç§»è„šæœ¬ 007_import_missing_parts_from_assemblies.js
4. [ ] åœ¨ä¸´æ—¶æ•°æ®åº“ä¸Šæµ‹è¯•å¯¼å…¥è„šæœ¬
5. [ ] æ‰§è¡ŒçœŸå®å¯¼å…¥ (npm run db:migrate)
6. [ ] åˆ›å»ºè¿ç§»è„šæœ¬ 008_migrate_assemblies_to_part_tree.js
7. [ ] åœ¨ä¸´æ—¶æ•°æ®åº“ä¸Šæµ‹è¯• part_tree è¿ç§»
8. [ ] æ‰§è¡ŒçœŸå®è¿ç§» (npm run db:migrate)
9. [ ] å®Œæ•´éªŒè¯å’Œæ›´æ–°æ–‡æ¡£

---

## ğŸ é¢„æœŸæˆæœ

è¿ç§»å®Œæˆåï¼š
- **part è¡¨**: ä» 291 æ¡å¢åŠ åˆ° ~1640 æ¡ï¼ˆæ–°å¢ ~1349 æ¡é›¶ä»¶ï¼‰
- **part_tree è¡¨**: åŒ…å« ~1499 æ¡å…³ç³»è®°å½•
- æ‰€æœ‰ part_tree çš„å¤–é”®éƒ½æœ‰æ•ˆ
- æ‰€æœ‰ assemblies æ•°æ®éƒ½è¢«æˆåŠŸè¿ç§»

