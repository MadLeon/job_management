# é¡¹ç›®å®Œæˆæƒ…å†µæ€»ç»“

**æ›´æ–°æ—¥æœŸ**: 2026-02-01 (Session 13)  
**æ€»ä½“çŠ¶æ€**: âœ… æ•°æ®åº“å®Œæ•´ â†’ **OEæ•°æ®åŒæ­¥è„šæœ¬å®Œæˆ** â†’ **NPOç”Ÿæˆé€»è¾‘ä¼˜åŒ–** â†’ **æ•°æ®é‡å¤é—®é¢˜å½»åº•è§£å†³** â†’ **NPOæ ¼å¼å…¨é¢è§„èŒƒåŒ–**  
**é¡¹ç›®è¿›åº¦**: 97% (æ•°æ®åº“å®Œæ•´ï¼ŒOEåŒæ­¥è„šæœ¬å®Œæˆï¼ŒNPOé‡å¤é—®é¢˜ä¿®å¤ï¼ŒNPOæ ¼å¼è§„èŒƒåŒ–å®Œæˆ)

---

## ğŸ“ Session 13: NPOæ ¼å¼å…¨é¢è§„èŒƒåŒ– + POå·è§„èŒƒåŒ–

**å®Œæˆæ—¥æœŸ**: 2026-02-01  
**ä»»åŠ¡**: ä¿®å¤æ—§NPOæ ¼å¼ï¼Œå¤„ç†é‡å¤POåˆå¹¶ï¼Œè§„èŒƒåŒ–æ‰€æœ‰POå·æ ¼å¼ï¼ˆåŒ…æ‹¬NPOå’Œæ­£å¸¸POï¼‰

### æ ¸å¿ƒæˆæœ

#### âœ… ç¬¬ä¸€éƒ¨åˆ†ï¼šNPOæ ¼å¼ä¿®å¤
**é—®é¢˜æè¿°**:
- 32æ¡æ—§æ ¼å¼NPO: `NPO-YYYYMMDD-COMPANY-SEQ` æ ¼å¼ä¸è§„èŒƒ
- å­˜åœ¨9æ¡é‡å¤POï¼ˆåŒä¸€OEå·å¯¹åº”å¤šæ¡POï¼‰
- å­˜åœ¨2æ¡NPOå˜ä½“æ ¼å¼: `NPO#` å’Œ `NPO ` ä¸è§„èŒƒ

**ä¿®å¤æ–¹æ¡ˆ**:
1. å°†æ‰€æœ‰æ—§æ ¼å¼NPOè½¬æ¢ä¸º `NPO-{oe_number}` æ–°æ ¼å¼ï¼ˆç®€æ´ã€å¹‚ç­‰ã€æ— é‡å¤ï¼‰
2. åˆå¹¶é‡å¤POï¼šä¿ç•™æœ€æ—©åˆ›å»ºçš„POï¼Œåˆ é™¤é‡å¤ï¼Œé‡å®šå‘å…³è”job
3. è§„èŒƒåŒ–NPOå˜ä½“æ ¼å¼

**æ‰§è¡Œç»“æœ**:
```
âœ… æ—§NPOæ ¼å¼è½¬æ¢: 18æ¡
   - NPO-20260120-* å’Œ NPO-20260127-* å…¨éƒ¨è½¬æ¢ä¸º NPO-{oe_number}
   - ç¤ºä¾‹: NPO-20260120-BOMBARDIER-40 â†’ NPO-39160

âœ… NPOé‡å¤åˆå¹¶: 5ç»„ï¼ˆåˆ é™¤9æ¡ï¼‰
   - OE 38848: 3æ¡â†’1æ¡ï¼Œé‡å®šå‘2ä¸ªjob
   - OE 38971: 2æ¡â†’1æ¡ï¼Œé‡å®šå‘1ä¸ªjob
   - OE 39137: 2æ¡â†’1æ¡ï¼Œé‡å®šå‘1ä¸ªjob
   - OE 39140: 5æ¡â†’1æ¡ï¼Œé‡å®šå‘4ä¸ªjob
   - OE 39160: 2æ¡â†’1æ¡ï¼Œé‡å®šå‘1ä¸ªjob

âœ… NPOå˜ä½“è§„èŒƒåŒ–: 2æ¡
   - "NPO#" â†’ NPO-39199
   - "NPO " â†’ NPO-38744
```

#### âœ… ç¬¬äºŒéƒ¨åˆ†ï¼šæ­£å¸¸POå·è§„èŒƒåŒ–
**é—®é¢˜æè¿°**:
- 16æ¡æ­£å¸¸POå·å«æœ‰ç©ºæ ¼å’Œå°å†™
- 3æ¡é¢å¤–é—®é¢˜ï¼šR.0Næ ¼å¼æœ‰å‰å¯¼é›¶ã€R.Næ ¼å¼ç¼ºå°‘è¿å­—ç¬¦
- æ ¼å¼ä¸ç»Ÿä¸€ï¼š"Rev." æ··ç”¨å°å†™

**ä¿®å¤æ–¹æ¡ˆ**:
1. ç§»é™¤POå·ä¸­çš„æ‰€æœ‰ç©ºæ ¼
2. å°† "Rev." ç®€åŒ–ä¸º "R."ï¼ˆä¿æŒå¤§å†™ï¼‰
3. ç¡®ä¿ "R." å‰æœ‰ "-"ï¼ˆè¡¥å……ç¼ºå¤±çš„è¿å­—ç¬¦ï¼‰
4. å»æ‰ "R.0N" ä¸­çš„å‰å¯¼é›¶ï¼ˆR.07 â†’ R.7ï¼‰
5. è½¬æ¢ä¸ºå¤§å†™å­—æ¯ç¡®ä¿ä¸€è‡´æ€§

**æ‰§è¡Œç»“æœ**:
```
âœ… è§„èŒƒåŒ–çš„PO: 22æ¡
   é¦–æ¬¡è§„èŒƒåŒ–: 16æ¡
   - "7000543134- Rev.1" â†’ "7000543134-R.1"
   - "634828-18000-52X-R231- R.03" â†’ "634828-18000-52X-R231-R.03"
   - "RT98-88040-PN-R004 R. 1" â†’ "RT98-88040-PN-R004R.1"
   
   é¢å¤–è§„èŒƒåŒ–ï¼ˆç¬¬1è½®ï¼‰: 3æ¡
   - "634828-15000-52BX-R079-R.07" â†’ "634828-15000-52BX-R079-R.7" (å»å‰å¯¼é›¶)
   - "634828-18000-52X-R231-R.03" â†’ "634828-18000-52X-R231-R.3" (å»å‰å¯¼é›¶)
   - "RT98-88040-PN-R004R.1" â†’ "RT98-88040-PN-R004-R.1" (è¡¥å……è¿å­—ç¬¦)
   
   é¢å¤–è§„èŒƒåŒ–ï¼ˆç¬¬2è½®ï¼‰: 3æ¡
   - "RT79-87540-PN-R003-R1" â†’ "RT79-87540-PN-R003-R.1" (è¡¥å……å°æ•°ç‚¹)
   - "RT98-87540-PN-R002-R1" â†’ "RT98-87540-PN-R002-R.1" (è¡¥å……å°æ•°ç‚¹)
   - "RT98-87590-PN-R007-R1" â†’ "RT98-87590-PN-R007-R.1" (è¡¥å……å°æ•°ç‚¹)
   - "RT98-87640-PN-R005-R1" â†’ "RT98-87640-PN-R005-R.1" (è¡¥å……å°æ•°ç‚¹)
   
âœ… æ— éœ€æ›´æ”¹çš„PO: 128æ¡ï¼ˆå·²è§„èŒƒï¼‰
```

#### âœ… ä¿®å¤è„šæœ¬
**ä¸»è„šæœ¬**: 
- [scripts/fix-npo-format.js](scripts/fix-npo-format.js) - NPOæ ¼å¼ä¿®å¤
- [scripts/normalize-po-numbers.js](scripts/normalize-po-numbers.js) - POå·è§„èŒƒåŒ–

**æ³¨**: è¿ç§»è„šæœ¬ä¸éœ€è¦ï¼Œç›´æ¥ä¿®å¤äº†æ•°æ®åº“ï¼ˆä¸€æ¬¡æ€§ä¿®å¤ï¼‰

#### âœ… æœ€ç»ˆæ•°æ®åº“ç»Ÿè®¡
| æŒ‡æ ‡ | ä¿®å¤å‰ | ä¿®å¤å | å¤‡æ³¨ |
|------|-------|-------|------|
| æ€»POæ•° | 184 | 175 | åˆ é™¤9æ¡é‡å¤NPO |
| NPOæ•° | 32 (æ—§æ ¼å¼) | 25 (è§„èŒƒåŒ–) | NPO-{oe_number}æ ¼å¼ |
| çœŸå®å®¢æˆ·PO | 152 | 150 | è§„èŒƒåŒ–æ ¼å¼ |
| POæ ¼å¼é—®é¢˜ | å«ç©ºæ ¼16 + å°å†™11 + å‰å¯¼é›¶2 + ç¼º-1 | 0 | å…¨éƒ¨ä¿®å¤ |
| Jobæ€»æ•° | 383 | 383 | é‡å®šå‘å®Œæ•´ |
| OrderItemæ€»æ•° | 412 | 412 | æ— å˜åŒ– |
| å…³è”å®Œæ•´æ€§ | âŒ | âœ… | å…¨éƒ¨ä¿®å¤ |

### ğŸ“‹ æ“ä½œæ¸…å•
- âœ… åˆ†ææ—§NPOæ ¼å¼å’Œé‡å¤æƒ…å†µ
- âœ… åˆ›å»ºNPOä¿®å¤è„šæœ¬
- âœ… æ‰§è¡ŒNPOä¿®å¤ï¼ˆ2æ¬¡å¤„ç†æ‰€æœ‰å˜ä½“ï¼‰
- âœ… åˆ†ææ­£å¸¸POå·è§„èŒƒåŒ–éœ€æ±‚
- âœ… åˆ›å»ºPOå·è§„èŒƒåŒ–è„šæœ¬
- âœ… æ‰§è¡ŒPOå·è§„èŒƒåŒ–ï¼ˆé¦–æ¬¡16æ¡ï¼‰
- âœ… å‘ç°é¢å¤–é—®é¢˜ï¼ˆR.0Nå‰å¯¼é›¶ã€ç¼º-ã€-RNæ ¼å¼ï¼‰
- âœ… æ›´æ–°è§„èŒƒåŒ–è„šæœ¬åŠ å…¥æ–°è§„åˆ™
- âœ… é‡æ–°æ‰§è¡Œè§„èŒƒåŒ–ï¼ˆç¬¬1è½®é¢å¤–3æ¡ï¼‰
- âœ… å†æ¬¡æ›´æ–°è§„èŒƒåŒ–è„šæœ¬åŠ å…¥-RNè§„åˆ™
- âœ… ç¬¬2è½®è§„èŒƒåŒ–æ‰§è¡Œï¼ˆé¢å¤–4æ¡ï¼ŒåŒ…æ‹¬id=439ï¼‰
- âœ… åˆ é™¤è¿ç§»è„šæœ¬ï¼ˆä¸€æ¬¡æ€§ä¿®å¤ï¼Œä¸éœ€è¦è¿ç§»ï¼‰
- âœ… å…¨é¢æ•°æ®éªŒè¯
- âœ… æ•°æ®åº“å¤‡ä»½: `data/record.db.backup.before_npo_fix`

### âœ… éªŒè¯æ¸…å•
```
ã€æ ¼å¼æ£€æŸ¥ã€‘
  âœ… æ— æ—§æ ¼å¼NPO (NPO-202*-*-*)
  âœ… NPOç»Ÿä¸€ä½¿ç”¨æ–°æ ¼å¼ (NPO-{oe_number})
  âœ… POå·æ— å¤šä½™ç©ºæ ¼
  âœ… POå·æ— å°å†™å­—æ¯
  âœ… POå·ä¸­ "Rev." ç»Ÿä¸€ç®€åŒ–ä¸º "R."
  âœ… -RN æ ¼å¼å·²æ”¹ä¸º -R.N
  âœ… R.0N æ ¼å¼å·²å»å‰å¯¼é›¶

ã€æ•°æ®ä¸€è‡´æ€§ã€‘
  âœ… æ— é‡å¤po_number
  âœ… æ— NULL po_number
  âœ… æ‰€æœ‰jobçš„po_idæŒ‡å‘æœ‰æ•ˆPO
  âœ… æ‰€æœ‰order_itemçš„job_idå’Œpart_idéƒ½æœ‰æ•ˆ
  âœ… æ— å­¤ç«‹jobæˆ–order_item
```

---

## ğŸ“ Session 12: NPOç”Ÿæˆé€»è¾‘ä¼˜åŒ– & æ•°æ®ä¸€è‡´æ€§ä¿®å¤

**å®Œæˆæ—¥æœŸ**: 2026-01-31  
**ä»»åŠ¡**: ä¿®å¤NPOé‡å¤ç”Ÿæˆé—®é¢˜ï¼Œæ¸…ç†é‡å¤çš„purchase_orderè®°å½•ï¼Œç¡®ä¿æ•´ä¸ªæ•°æ®åº“çš„æ•°æ®ä¸€è‡´æ€§

### æ ¸å¿ƒæˆæœ

#### âœ… NPOç”Ÿæˆé€»è¾‘ä¼˜åŒ–
**é—®é¢˜æ ¹æº**: æ—§çš„NPOæ ¼å¼ `NPO-YYYYMMDD-COMPANY-SEQ` æ¯æ¬¡è¿è¡Œæ—¶é€’å¢åºå·ï¼Œå¯¼è‡´åŒä¸€OEå·å¤šæ¬¡åˆ›å»ºä¸åŒçš„PO

**è§£å†³æ–¹æ¡ˆ**: 
- ä¿®æ”¹ [update-oe-database.js](scripts/one-time-scripts/update-oe-database.js) ç¬¬314-318è¡Œï¼š`NPO-${oe_number}`
- ä¿®æ”¹ [mod_AddNewJobToDB.bas](src/order%20entry%20log/mod_AddNewJobToDB.bas) ç¬¬68-72è¡Œï¼šVBAå¯¹é½
- **æ–°æ ¼å¼ç‰¹æ€§**: å¹‚ç­‰æ€§ - ç›¸åŒoe_numberå§‹ç»ˆç”Ÿæˆç›¸åŒPOå·

#### âœ… æ•°æ®æ¸…ç†è„šæœ¬ - clean-duplicate-order-items.js
**åŠŸèƒ½**: è‡ªåŠ¨è¯†åˆ«å’Œæ¸…ç†é‡å¤order_itemè®°å½•
- æŒ‰(oe_number, line_number)ç»„åˆæŸ¥æ‰¾é‡å¤é¡¹
- ä¿ç•™æœ€æ—©åˆ›å»ºçš„order_itemï¼Œåˆ é™¤å…¶ä»–å‰¯æœ¬
- çº§è”åˆ é™¤å­¤ç«‹jobå’Œpurchase_order
- è‡ªåŠ¨æ¿€æ´»æ‰€æœ‰ä¿ç•™POçš„is_active=1

**æ‰§è¡Œç»“æœ**:
```
âœ“ å‘ç°12ä¸ªé‡å¤(oe_number, line_number)ç»„åˆ
âœ“ åˆ é™¤13æ¡é‡å¤purchase_orderè®°å½•  
âœ“ æ¸…ç†åå·²æ¿€æ´»184ä¸ªPO (is_active=1)
âœ“ é›¶å­¤ç«‹æ•°æ® (æ— orphaned job, PO)
```

#### âœ… å…¨æ•°æ®åº“è¯Šæ–­ä¸éªŒè¯
**åˆ›å»ºè¯Šæ–­è„šæœ¬**: [diagnose-full-database.js](scripts/diagnose-full-database.js)

**è¯Šæ–­ç»“æœ**:
| æ£€æŸ¥é¡¹ | ç»“æœ | è¯´æ˜ |
|--------|------|------|
| é‡å¤order_item | âœ… | 0ä¸ªé‡å¤ |
| å­¤ç«‹job | âœ… | 0ä¸ªå­¤ç«‹ |
| å­¤ç«‹PO | âœ… | 0ä¸ªå­¤ç«‹ |
| POæ¿€æ´»çŠ¶æ€ | âœ… | 184ä¸ªå…¨æ¿€æ´» |
| æ•°æ®å®Œæ•´æ€§ | âœ… | å®Œå…¨ä¸€è‡´ |

**æ•°æ®ç»Ÿè®¡**:
- POæ€»æ•°: 184ä¸ª (å…¶ä¸­152ä¸ªéNPOæ ¼å¼çš„çœŸå®å®¢æˆ·PO)
- Jobæ€»æ•°: 383ä¸ª
- Order Itemæ€»æ•°: 412ä¸ª
- å…³é”®å‘ç°: 1ä¸ªPOå¯èƒ½å…³è”å¤šä¸ªjobå’Œorder_item (æ­£å¸¸ä¸šåŠ¡è®¾è®¡)

### ğŸ“‹ æ“ä½œæ¸…å•
- âœ… ä¿®å¤NPOç”Ÿæˆé€»è¾‘ (update-oe-database.js, mod_AddNewJobToDB.bas)
- âœ… åˆ›å»ºå¹¶æ‰§è¡Œæ¸…ç†è„šæœ¬ (clean-duplicate-order-items.js)
- âœ… ä¿®å¤è„šæœ¬è¯­æ³•é”™è¯¯ (å‡½æ•°ç»“æ„)
- âœ… å…¨æ•°æ®åº“è¯Šæ–­å’ŒéªŒè¯ (diagnose-full-database.js)
- â³ NPOæ ¼å¼è½¬æ¢è„šæœ¬ (å¯é€‰ - ä¿ç•™æ—§æ•°æ®å³å¯)
- â³ ä»£ç æ³¨é‡Šæ–‡æ¡£æ›´æ–°

---

## ğŸ“ Session 10-11: Order Entry Log æ•°æ®åº“åŒæ­¥è„šæœ¬

**å®Œæˆæ—¥æœŸ**: 2026-01-27 (Session 10-11)  
**ä»»åŠ¡**: åˆ›å»ºå¯å¤ç”¨çš„Node.jsè„šæœ¬è‡ªåŠ¨åŒæ­¥OEè¡¨æ•°æ®åˆ°record.dbï¼Œæ”¯æŒè¡ŒåŒ¹é…ã€æ–°å¢æ’å…¥ã€è¿‡æœŸæ ‡è®°å’Œå®Œæ•´å›æ»š

### æ ¸å¿ƒæˆæœ

#### âœ… ä¸»åŒæ­¥è„šæœ¬: update-oe-database.js
**ä½ç½®**: `scripts/update-oe-database.js` (791è¡Œ)

**åŠŸèƒ½æ¦‚è§ˆ**:
- ä»Order Entry Log.xlsmè¯»å–381è¡Œæ•°æ®(DELIVERY SCHEDULEè¡¨)
- ä½¿ç”¨(oe_number, line_number)ç»„åˆå”¯ä¸€åŒ¹é…OEè¡Œ
- çº§è”æ’å…¥Customerâ†’Contactâ†’POâ†’Jobâ†’Partâ†’OrderItem(7æ­¥)
- ç”Ÿæˆä¸´æ—¶PO: NPO-{æ—¥æœŸ}-{å…¬å¸}-{åºå·}
- æ ‡è®°è¿‡æœŸPOä¸ºis_active=0
- **ç›´æ¥å†™å…¥Excel AAåˆ—ï¼Œè¿”å›order_item_id** âœ“

**å…³é”®ç‰¹æ€§**:
| åŠŸèƒ½ | çŠ¶æ€ | å¤‡æ³¨ |
|------|------|------|
| Excelè¯»å–(PowerShell) | âœ… | è¯†åˆ«è¡¨å¤´ç¬¬3è¡Œï¼Œæ•°æ®ç¬¬4è¡Œå¼€å§‹ |
| æ•°æ®åŒ¹é… | âœ… | (oe_number, line_number)å”¯ä¸€è¯†åˆ« |
| ä¸´æ—¶POç”Ÿæˆ | âœ… | NPO-20260127-COMPANY-01æ ¼å¼ |
| çº§è”æ’å…¥ | âœ… | 7æ­¥å®Œæ•´æµç¨‹ï¼Œæ”¯æŒPartè¡¨ |
| AAåˆ—å†™å…¥ | âœ… | PowerShell COMç›´æ¥æ›´æ–° |
| äº‹åŠ¡ç®¡ç† | âœ… | SQLite IMMEDIATEï¼Œå®Œæ•´å›æ»š |
| è¿‡æœŸæ ‡è®° | âœ… | is_active=0è‡ªåŠ¨æ ‡è®° |

**ä¸‰ä¸ªæ ¸å¿ƒåœºæ™¯**:
1. **å·²å­˜åœ¨**: OEä¸­çš„è¡Œåœ¨DBå­˜åœ¨ â†’ è®°å½•order_item_id
2. **æ–°å¢**: ä¸å­˜åœ¨ â†’ çº§è”æ’å…¥ â†’ è¿”å›æ–°order_item_id
3. **è¿‡æœŸ**: DBä¸­çš„POä¸åœ¨OEä¸­ â†’ æ ‡è®°is_active=0

**è¿è¡Œæ•ˆæœ** (æµ‹è¯•ç»“æœ):
```
âœ“ è¯»å–Excel: 381è¡Œ
âœ“ å¤„ç†æ•°æ®: 2è¡Œå·²å­˜åœ¨åŒ¹é…
âœ… Excel AAåˆ—æ›´æ–°: 2ä¸ªå•å…ƒæ ¼
â±ï¸ è€—æ—¶: 113ç§’
```

#### âœ… å•å…ƒæµ‹è¯•éªŒè¯
- âœ… ä¸´æ—¶POå·ç”Ÿæˆ(NPOæ ¼å¼éªŒè¯)
- âœ… æ•°æ®åŒ¹é…é€»è¾‘(oe_number+line_numberæŸ¥è¯¢)
- âœ… çº§è”æ’å…¥é€»è¾‘(7æ­¥å®Œæ•´+Partè¡¨)
- âœ… è¿‡æœŸPOæ ‡è®°(is_activeæ›´æ–°)
- **æ€»è®¡: 4/4é€šè¿‡** âœ“

#### âœ… äº‹åŠ¡å’Œå›æ»šæœºåˆ¶
- SQLite IMMEDIATEéš”ç¦»çº§åˆ«
- å•ä¸€äº‹åŠ¡å†…æ‰€æœ‰æ“ä½œ
- ä»»ä½•é”™è¯¯è‡ªåŠ¨ROLLBACK
- å·²æ ‡è®°çš„POè‡ªåŠ¨æ¢å¤is_active=1

---

### ğŸ“Š é¡¹ç›®è¿›åº¦æ›´æ–°

**Session 11æ”¹è¿›**:
- ä¿®å¤Excelè¡¨å¤´è¯†åˆ«(ç¬¬3è¡Œè€Œéç¬¬1è¡Œ)
- å®ç°PowerShell AAåˆ—ç›´æ¥å†™å…¥Excel âœ“
- å®Œæˆç«¯åˆ°ç«¯æµç¨‹: Excelâ†’DBâ†’Excel
- éªŒè¯381è¡Œæ•°æ®çš„å®Œæ•´å¤„ç†

**æ–‡æ¡£æ•´ç†**:
- æ‰€æœ‰æ–‡æ¡£ç»Ÿä¸€å­˜æ”¾è‡³ `scripts/oe-sync-docs/`
- åŒ…å«ä½¿ç”¨æŒ‡å—ã€éªŒè¯æŠ¥å‘Šã€è¿è¡Œæ—¥å¿—
- åˆ é™¤æ‰€æœ‰ä¸´æ—¶è°ƒè¯•æ–‡ä»¶

---



---

## ğŸ“ Session 9: Drawing File æ™ºèƒ½åŒ¹é…ç³»ç»Ÿ (æœ¬session)

**ä¸»è¦ä»»åŠ¡**: 
1. åˆ›å»ºå¯å¤ç”¨çš„å›¾çº¸åŒ¹é…è„šæœ¬
2. æ‰¹é‡æ›´æ–° drawing_file è¡¨çš„ part_id
3. æ”¹è¿›APIï¼Œä½¿ç”¨æ•°æ®åº“å­˜å‚¨æ•°æ® + åŠ¨æ€åŒ¹é…å¤‡ç”¨æ–¹æ¡ˆ

### æ ¸å¿ƒæˆæœ

#### âœ… 1. match-part-drawing.js è„šæœ¬
**ä½ç½®**: `scripts/match-part-drawing.js`

**åŠŸèƒ½**: æ ¹æ® part çš„ drawing_number æ™ºèƒ½åŒ¹é… drawing_file

**åŒ¹é…æµç¨‹**:
1. æ¨¡ç³Šæœç´¢: file_name åŒ…å« drawing_number
2. ç²¾ç¡®éªŒè¯: ä½¿ç”¨ folder_mapping æ£€æŸ¥æ–‡ä»¶è·¯å¾„
3. ç»“æœä¼˜å…ˆçº§: ä¼˜å…ˆè¿”å› is_active=1 çš„ç»“æœï¼Œå¦åˆ™è¿”å›æœ€æ–°ä¿®æ”¹çš„

**å¯¼å‡ºå‡½æ•°**:
- `matchPartToDrawing(db, part, customer_id)` - ä¸»åŒ¹é…å‡½æ•°ï¼Œè¿”å› { success, file_id, confidence, reason }
- `getCustomerIdFromOrderItem(db, order_item_id)` - è·å–customer_idï¼Œé€šè¿‡ order_itemâ†’jobâ†’purchase_orderâ†’customer_contactâ†’customer

**åŒ¹é…ç»“æœç½®ä¿¡åº¦çº§åˆ«**:
- `verified` - é€šè¿‡ folder_mapping ç²¾ç¡®éªŒè¯æˆåŠŸï¼ˆæœ€é«˜ï¼‰
- `fuzzy_no_folder` - å®¢æˆ·æ—  folder_mappingï¼Œè¿”å›æ¨¡ç³ŠåŒ¹é…ç»“æœ
- `fuzzy_folder_mismatch` - folder_mapping éªŒè¯å¤±è´¥ï¼Œè¿”å›æ¨¡ç³ŠåŒ¹é…ç»“æœ
- `fuzzy` - å®¢æˆ·æ—  customer_idï¼Œç›´æ¥è¿”å›æ¨¡ç³ŠåŒ¹é…ç»“æœ
- `none` - æœªæ‰¾åˆ°ä»»ä½•åŒ¹é…

#### âœ… 2. è¿ç§»è„šæœ¬ 012_populate_drawing_file_part_id.js
**ä½ç½®**: `scripts/migrations/012_populate_drawing_file_part_id.js`

**åŠŸèƒ½**: æ‰¹é‡éå† order_itemï¼Œè°ƒç”¨è„šæœ¬1è¿›è¡ŒåŒ¹é…ï¼Œæ›´æ–° drawing_file çš„ part_id

**æ‰§è¡Œç»“æœ** (2026-01-12 11:00):
```
å·²å¤„ç† order_item: 358
æˆåŠŸåŒ¹é…: 226 (74.83%)
å·²è·³è¿‡ï¼ˆå·²æœ‰part_idï¼‰: 56
æ— æ³•åŒ¹é…: 76 (21.13%)
æ•°æ®åº“æ›´æ–°: 224 æ¡ drawing_file è®°å½•
```

**åŒ¹é…è¦†ç›–ç‡**: 224/137,399 = 0.16%ï¼ˆä½è¦†ç›–ç‡åŸå› ï¼šå¤§å¤šæ•°partæ— order_itemå…³è”ï¼Œæˆ–order_itemå¯¹åº”çš„customeræ— folder_mappingï¼‰

#### âœ… 3. drawing-file-helper.js è¾…åŠ©å‡½æ•°åº“
**ä½ç½®**: `src/lib/drawing-file-helper.js` (æ–°å»º)

**åŠŸèƒ½**: ä¸ºAPIæä¾›ç»Ÿä¸€çš„å›¾çº¸æŸ¥æ‰¾æ¥å£

**å¯¼å‡ºå‡½æ•°**:
- `findDrawingFile(db, drawingNumber, customerId = null)` 
  - å…ˆæŸ¥æ•°æ®åº“ï¼ˆpart_idå·²å¡«å……çš„è®°å½•ï¼‰
  - å¦‚ä¸å­˜åœ¨ï¼Œè°ƒç”¨ matchPartToDrawing åŠ¨æ€åŒ¹é…
  - åŒ¹é…æˆåŠŸåˆ™æ›´æ–°æ•°æ®åº“ï¼ŒæŒä¹…åŒ–ç»“æœ

**è®¾è®¡ç†å¿µ**: 
- æ•°æ®åº“ä¼˜å…ˆï¼šå·²åŒ¹é…çš„æ•°æ®ç›´æ¥è¿”å›ï¼Œæ— å»¶è¿Ÿ
- åŠ¨æ€è¡¥å……ï¼šå¯¹æœªåŒ¹é…çš„è®°å½•ï¼Œå®æ—¶è°ƒç”¨åŒ¹é…è„šæœ¬
- æŒä¹…åŒ–å­¦ä¹ ï¼šæ¯æ¬¡åŠ¨æ€åŒ¹é…æˆåŠŸéƒ½æ›´æ–°æ•°æ®åº“ï¼Œç§¯ç´¯å†å²æ•°æ®

#### âœ… 4. æ”¹è¿›çš„ API è·¯ç”±

**ä¿®æ”¹çš„æ–‡ä»¶**:

1. `/api/drawings/detail.js` æ”¹è¿›
   - ä¹‹å‰ï¼šç›´æ¥åœ¨ drawing_file ä¸­æ¨¡ç³ŠæŸ¥è¯¢
   - æ”¹è¿›ï¼šä½¿ç”¨ findDrawingFile è¾…åŠ©å‡½æ•°ï¼Œæ”¯æŒæ•°æ®åº“ä¼˜å…ˆ + åŠ¨æ€åŒ¹é…

2. `/api/jobs/drawing-file-location.js` æ”¹è¿›
   - ä¹‹å‰ï¼šç®€å•æ¨¡ç³ŠåŒ¹é…ï¼Œæ— folder_mappingéªŒè¯
   - æ”¹è¿›ï¼šè°ƒç”¨ findDrawingFileï¼Œæ”¯æŒç²¾ç¡®éªŒè¯ + å®¢æˆ·åç§°è¿‡æ»¤

**APIè°ƒç”¨æµç¨‹å›¾**:
```
API è¯·æ±‚ (drawing_number, å¯é€‰: customer_name)
  â†“
findDrawingFile() [drawing-file-helper.js]
  â†“
1. æ•°æ®åº“æŸ¥è¯¢ drawing_file (part_id IS NOT NULL)
  â†“
  â”œâ”€ æœ‰ç»“æœ â†’ è¿”å› âœ“
  â”œâ”€ æ— ç»“æœ â†“
  â””â”€ è°ƒç”¨ matchPartToDrawing() [match-part-drawing.js]
       â†“
       â”œâ”€ åŒ¹é…æˆåŠŸ â†’ æ›´æ–°æ•°æ®åº“ + è¿”å› âœ“
       â””â”€ åŒ¹é…å¤±è´¥ â†’ è¿”å› null
```

### ğŸ“Š æ•°æ®å¯¹æ¯”

| æŒ‡æ ‡ | Session 8 | Session 9 | å˜åŒ– |
|------|----------|----------|------|
| drawing_file part_idå·²å¡«å…… | 0 | 224 | +224 |
| order_item è¦†ç›–ç‡ | 0% | 63% (226/358) | +63% |
| folder_mapping å‚ä¸åº¦ | 66/79 | ç”¨äºéªŒè¯ | ç²¾ç¡®éªŒè¯ |
| API æ™ºèƒ½ç¨‹åº¦ | ç®€å•æ¨¡ç³Š | ä¼˜å…ˆçº§+åŠ¨æ€ | å¤§å¹…æå‡ |

### ğŸ”§ æŠ€æœ¯äº®ç‚¹

1. **is_active æ™ºèƒ½å¤„ç†**: ä¼˜å…ˆè¿”å› is_active=1ï¼Œå¦‚å…¨éƒ¨ä¸º0åˆ™è¿”å›æœ€æ–°ä¿®æ”¹çš„
2. **é”™è¯¯ä¼˜é›…é™çº§**: å®¢æˆ·æ— folder_mappingæ—¶ï¼Œä»è¿”å›æ¨¡ç³ŠåŒ¹é…ç»“æœï¼ˆè€Œéå¤±è´¥ï¼‰
3. **æŒä¹…åŒ–å­¦ä¹ **: æ¯æ¬¡APIåŠ¨æ€åŒ¹é…éƒ½æ›´æ–°æ•°æ®åº“ï¼Œé¿å…é‡å¤è®¡ç®—
4. **åˆ†ç¦»å…³æ³¨ç‚¹**: åŒ¹é…é€»è¾‘ç‹¬ç«‹è„šæœ¬ï¼Œå¯è¢«è¿ç§»å’ŒAPIå¤ç”¨

### ğŸ“ˆ åç»­ä¼˜åŒ–ç©ºé—´

1. **æé«˜è¦†ç›–ç‡**: å¯¹æ— order_itemçš„partè¿›è¡ŒäºŒçº§åŒ¹é…ï¼ˆåŸºäºdrawing_numberå…¨è¡¨æœç´¢ï¼‰
2. **ç¼“å­˜æœºåˆ¶**: å°†çƒ­æŸ¥è¯¢çš„ç»“æœç¼“å­˜ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢
3. **æ‰¹é‡åŒ¹é…**: å®ç° `/api/drawings/batch-match` æ”¯æŒæ‰¹é‡æŸ¥è¯¢
4. **åŒ¹é…å®¡æ ¸**: åˆ›å»º UI ç•Œé¢å…è®¸ç”¨æˆ·æ‰‹å·¥ç¡®è®¤è‡ªåŠ¨åŒ¹é…ç»“æœ

---

**è¿”å›å€¼**: 
```javascript
{
  success: boolean,
  file_id: number|null,
  confidence: 'verified'|'fuzzy'|'fuzzy_no_folder'|'fuzzy_folder_mismatch'|'none'|'error',
  reason: string
}
```

#### âœ… 2. è¿ç§»è„šæœ¬ 012_populate_drawing_file_part_id.js
**ä½ç½®**: `scripts/migrations/012_populate_drawing_file_part_id.js`

**æ‰§è¡Œç»“æœ**:
```
ğŸ“Š è¿ç§»ç»Ÿè®¡:
   æ€» order_item æ•°: 358
   æ€» part æ•°: 358
   âœ“ æˆåŠŸåŒ¹é…: 226 (63.1%)
   âŠ˜ å·²è·³è¿‡ï¼ˆå·²æœ‰part_idï¼‰: 56
   âœ— æœªæ‰¾åˆ°: 76 (21.2%)
   ğŸ“Š drawing_file æ›´æ–°: 224 æ¡è®°å½•
```

**æˆåŠŸç‡**: 74.83% (226 / (358-56))

**è¯´æ˜**: 
- 226 æ¡è®°å½•æˆåŠŸè·å¾— part_id
- 56 æ¡è®°å½•å·²æœ‰ part_idï¼Œè¢«è·³è¿‡
- 76 æ¡è®°å½•æ— æ³•åŒ¹é…ï¼ˆå¯èƒ½æ˜¯æ•°æ®è´¨é‡é—®é¢˜æˆ–å®¢æˆ·æ— folder_mappingï¼‰

#### âœ… 3. æ”¹è¿›çš„APIç³»ç»Ÿ

**æ–°å¢: src/lib/drawing-file-helper.js**

```javascript
function findDrawingFile(db, drawingNumber, customerId = null)
```

**æŸ¥è¯¢ç­–ç•¥** (æŒ‰ä¼˜å…ˆçº§):
1. **å·²å­˜å‚¨**: part_idä¸ä¸ºNULL â†’ ç›´æ¥è¿”å›
2. **åŠ¨æ€åŒ¹é…**: æ¨¡ç³Šæœç´¢ + è‡ªåŠ¨å¡«å……part_id
3. **ç²¾ç¡®è¿‡æ»¤**: è‹¥æä¾›customer_idï¼Œè¿›è¡Œcustomerå…³è”è¿‡æ»¤

**æ”¹è¿›çš„API**:
- `GET /api/drawings/detail`
  - æ–°å‚æ•°: `customer_id` (å¯é€‰)
  - ä½¿ç”¨ findDrawingFile æ›¿ä»£åŸå§‹æŸ¥è¯¢
  
- `GET /api/jobs/drawing-file-location`
  - æ–°è¿”å›å­—æ®µ: `partId` (è·å–åˆ°çš„part_id)
  - ä¼˜å…ˆè¿”å›å·²å­˜å‚¨çš„ part_id ç»“æœ
  - æ”¯æŒå®¢æˆ·åç§°å’Œcustomer_idåŒé‡è¿‡æ»¤

### ğŸ” æµ‹è¯•ç»“æœ

**å•å…ƒæµ‹è¯•**: âœ… 4/4 é€šè¿‡

| æµ‹è¯•ç”¨ä¾‹ | ç»“æœ | è¯´æ˜ |
|--------|------|------|
| æœ‰part_idä¸”customeråŒ¹é… | âœ… | æ–‡ä»¶id=151593 (GM223-1314-9) |
| æœ‰part_idä¸”customeråŒ¹é… | âœ… | æ–‡ä»¶id=163883 (K125912-003) |
| æ— part_idçš„drawing | âœ… | åŠ¨æ€åŒ¹é…æ‰¾åˆ°: æ–‡ä»¶id=167349 (052PLNAY01) |
| ä¸å­˜åœ¨çš„drawing_number | âœ… | æ­£ç¡®è¿”å›null |

### ğŸ“Š æ•°æ®è¦†ç›–åˆ†æ

**drawing_file è¡¨çŠ¶æ€**:
```
æ€»è®°å½•æ•°: 137,399
å·²æœ‰part_id: 224 (0.16%)
å¾…å¡«å……: 137,175 (99.84%)
```

**åŒ¹é…è¦†ç›–ç‡åˆ†æ**:
- 358 ä¸ª order_item å¯¹åº”çš„ part
- å…¶ä¸­ 226 ä¸ªæˆåŠŸåŒ¹é… (63.1%)
- è¿™æ„å‘³ç€ç›¸å…³çš„ 226 ä¸ª drawing_file å·²å»ºç«‹ part_id å…³è”
- å‰©ä½™ 137,149 ä¸ª drawing_file æ˜¯å…¶ä»–éƒ¨åˆ†æˆ–å†å²æ•°æ®

### ğŸ’¡ è®¾è®¡äº®ç‚¹

1. **ä¼˜å…ˆçº§æœºåˆ¶**: is_active=1 ä¼˜å…ˆï¼Œä¿è¯ä½¿ç”¨å·²éªŒè¯çš„ç»“æœ
2. **åŠ¨æ€å›æº**: æœªå­˜å‚¨æ—¶è‡ªåŠ¨ä»æ–‡ä»¶åŒ¹é…æ¨å¯¼
3. **æ•°æ®æŒä¹…åŒ–**: åŒ¹é…ç»“æœè‡ªåŠ¨ä¿å­˜åˆ°æ•°æ®åº“
4. **å®¹é”™è®¾è®¡**: å®¢æˆ·æ— folder_mappingæ—¶è‡ªåŠ¨é™çº§ä¸ºæ¨¡ç³ŠåŒ¹é…
5. **æ¨¡å—å¤ç”¨**: match-part-drawingå¯è¢«APIã€è¿ç§»ã€å…¶ä»–è„šæœ¬å¤ç”¨

---

## ğŸ“ Session 8: å®¢æˆ·-æ–‡ä»¶å¤¹å…³è”å»ºç«‹

**ä¸»è¦ä»»åŠ¡**: æ‰«æGç›˜æ–‡ä»¶å¤¹å¹¶ä¸79ä¸ªå®¢æˆ·è¿›è¡Œæ¨¡ç³ŠåŒ¹é…ï¼Œå»ºç«‹folder_mappingè¡¨

### æ ¸å¿ƒæ“ä½œ

| æ­¥éª¤ | ç»†èŠ‚ | ç»“æœ |
|------|------|------|
| âœ… æ‰«æGç›˜ | è·å–G:\ä¸€çº§æ–‡ä»¶å¤¹åˆ—è¡¨ | 315ä¸ªæ–‡ä»¶å¤¹ |
| âœ… æ¨¡ç³ŠåŒ¹é… | ä½¿ç”¨Levenshteinè·ç¦»+åŒ…å«åŒ¹é…ç®—æ³• | 59ä¸ªè‡ªåŠ¨åŒ¹é…ï¼Œ20ä¸ªæœªåŒ¹é… |
| âœ… ç”¨æˆ·ç¡®è®¤ | æ‰‹åŠ¨å®¡æŸ¥å’Œç¡®è®¤ï¼ŒæŒ‡å®šæ­£ç¡®çš„æ˜ å°„å…³ç³» | 66ä¸ªå…³ç³»å·²ç¡®è®¤ |
| âœ… æ•°æ®å¯¼å…¥ | åˆ›å»º011è¿ç§»è„šæœ¬ï¼Œå¡«å……folder_mappingè¡¨ | 66ä¸ªå…³ç³»æ’å…¥æˆåŠŸ |

### åŒ¹é…ç»Ÿè®¡

| åˆ†ç±» | æ•°é‡ | è¦†ç›–ç‡ |
|------|------|--------|
| å·²åŒ¹é…ä¸”ç¡®è®¤ | 66 | 83.5% (66/79) |
| æœªåŒ¹é… | 13 | 16.5% |
| æ€»å®¢æˆ·æ•° | 79 | 100% |

### æ•°æ®éªŒè¯

- âœ… folder_mappingè¡¨: 66æ¡è®°å½•
- âœ… is_verifiedå­—æ®µå…¨éƒ¨æ ‡è®°ä¸º1ï¼ˆå·²ç¡®è®¤ï¼‰
- âœ… æ ·æœ¬éªŒè¯: AB Sciexâ†’AB SCIEX, ATS-Corpâ†’ATS (Automation Tooling Systems)ç­‰

### æœªåŒ¹é…çš„13ä¸ªå®¢æˆ·

Blenheim, Buffalo, DieMax, Hunstville, Kipling, Lux, Motion Ind, Nuclear Waste Mgnt, Shanghai, VNS-Federal, Van Rob (å…±11ä¸ªå®Œå…¨æ— åŒ¹é…+å…¶ä»–ç‰¹æ®Šæƒ…å†µ)

---

## ğŸ“ Session 7: å®¢æˆ·è¡¨æ‰©å±•
| âœ… æ–‡æ¡£æ›´æ–° | structure.txtåŠsessionæ€»ç»“ | å®Œæˆ |

---

## ğŸ“ Session 6: UIä¿®å¤ä¸æ•°æ®è¿ç§»BUGä¿®å¤ ğŸ”§

**ä¸»è¦ä»»åŠ¡**: ä¿®å¤ order items é¡µé¢çš„ä¸‹æ‹‰ç®­å¤´é€»è¾‘ã€å±•å¼€å†…å®¹æ˜¾ç¤ºå’Œæ•°æ®è¿ç§»BUG

### æ ¸å¿ƒé—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

| é—®é¢˜ | æ ¹æœ¬åŸå›  | è§£å†³æ–¹æ¡ˆ | å½±å“èŒƒå›´ |
|------|---------|---------|---------|
| ä¸‹æ‹‰ç®­å¤´ä¸æ˜¾ç¤º | APIç¼ºå°‘ `has_assembly_details` å­—æ®µ | åœ¨ `/api/order-items` ä¸­æ·»åŠ  LEFT JOIN part_tree + CASE WHEN é€»è¾‘ | 358ä¸ªorder_items |
| å±•å¼€å†…å®¹ä¸ºç©º | useAssemblies hookè°ƒç”¨ä¸å­˜åœ¨çš„API + ä½¿ç”¨é”™è¯¯å‚æ•°(part_number) | åˆ›å»º `/api/parts/[id]/children` API + ä¿®æ”¹hookä½¿ç”¨part_id + æ·»åŠ orderItemId | æ‰€æœ‰assembly item |
| Sticky headerå†²çª | JobDetailTableæ— stickyå®šä½ï¼Œå¯¼è‡´æ»šåŠ¨æ—¶headeræ··ä¹± | æ·»åŠ  sticky + zIndex=5ï¼ˆä½äºJobTableçš„10ï¼‰ | æ‰€æœ‰è¡Œå±•å¼€æ—¶ |
| å®¢æˆ·åç§°ä¸ºç©ºï¼ˆJob72297ï¼‰ | 006è¿ç§»è„šæœ¬bugï¼šæ­¥éª¤4é‡æ–°åˆ›å»ºä¸´æ—¶POæ—¶contact_idè®¾ä¸ºNULL | ä¿®å¤è„šæœ¬è¡Œ254-262ï¼Œæ·»åŠ contact_idæ˜ å°„é€»è¾‘ | 30ä¸ªå—å½±å“çš„PO |

### å®Œæˆå·¥ä½œæ¸…å•

| åŠŸèƒ½ | ç»†èŠ‚ | çŠ¶æ€ |
|------|------|------|
| âœ… API: /api/order-items/index.js | æ–°å»ºã€‚LEFT JOIN part_treeæŸ¥è¯¢has_assembly_details | å®Œæˆ |
| âœ… API: /api/parts/[id]/children.js | æ–°å»ºã€‚è¿”å›å­ç»„ä»¶ï¼Œç»§æ‰¿parent order_itemçš„timing/status | å®Œæˆ |
| âœ… Hook: useJobs.js | ä¿®æ”¹fetch URLï¼š`/api/jobs` â†’ `/api/order-items` | å®Œæˆ |
| âœ… Hook: useAssemblies.js | æ”¹å‚æ•°(partNumberâ†’partId)ï¼Œæ·»åŠ orderItemIdï¼Œæ–°endpoint | å®Œæˆ |
| âœ… Component: JobTableRow.jsx | ä¼ é€’row.part_idå’Œrow.order_item_idç»™useAssemblies | å®Œæˆ |
| âœ… Component: JobDetailTable.jsx | æ·»åŠ sticky headerï¼šposition+top+zIndex+bgColor | å®Œæˆ |
| âœ… Migration: 006_migrate_data_from_jobs_db.js | ä¿®å¤step4çš„contact_idæ˜ å°„ï¼ˆè¡Œ254-262ï¼‰ | å®Œæˆ |
| âœ… æ•°æ®åº“æ¢å¤ | å›æ»šâ†’ä¿®å¤â†’é‡æ–°è¿ç§»006-009 | å®Œæˆ |
| âœ… æ–‡æ¡£æ›´æ–° | structure.txtå·²æ›´æ–°ï¼Œsessionæ€»ç»“å·²è¡¥å…… | å®Œæˆ |

### è¿ç§»BUGè¯¦ç»†åˆ†æ

**åŸå§‹é—®é¢˜åœºæ™¯**ï¼š
```
Job 72297 â†’ PO_id=317 â†’ contact_id=NULL â†’ customer_nameç¼ºå¤± â†’ UIæ˜¾ç¤ºä¸ºç©º
```

**Bugä½ç½®**: `006_migrate_data_from_jobs_db.js` ç¬¬254-262è¡Œ

**åŸå§‹é”™è¯¯ä»£ç **:
```javascript
// æ­¥éª¤4ï¼šåˆ›å»ºjobæ—¶é‡æ–°åˆ›å»ºä¸´æ—¶PO
// é—®é¢˜ï¼šcontact_idæ²¡æœ‰ä»åŸæ•°æ®æ˜ å°„ï¼Œç›´æ¥è®¾ä¸ºNULL
newDb.prepare(`
  INSERT INTO purchase_order (customer_id, contact_id, po_number, ...)
  VALUES (?, NULL, ?, ...)  // âŒ contact_id=NULLé”™è¯¯
`).run(customerId, ...);
```

**ä¿®å¤åä»£ç **:
```javascript
// ä»oldDbè·å–åŸcustomer_contactå­—æ®µ
const jobContactInfo = oldDb.prepare(`
  SELECT customer_contact FROM jobs WHERE job_number = ? LIMIT 1
`).get(job_number);

// é€šè¿‡contactMapæ˜ å°„å¾—åˆ°æ­£ç¡®çš„contact_id
const contactId = jobContactInfo?.customer_contact 
  ? contactMap.get(`${customer_name}|${jobContactInfo.customer_contact}`)
  : null;

// ä½¿ç”¨æ­£ç¡®çš„contact_idæ’å…¥
newDb.prepare(`
  INSERT INTO purchase_order (customer_id, contact_id, po_number, ...)
  VALUES (?, ?, ?, ...)  // âœ… contact_idæ­£ç¡®æ˜ å°„
`).run(customerId, contactId, ...);
```

**å½±å“èŒƒå›´**: 30ä¸ªPOè®°å½•ï¼ˆå æ€»æ•° 172 çš„ 17%ï¼‰

**æ¢å¤è¿‡ç¨‹**:
1. âœ… æ‰§è¡Œ4æ¬¡ `npm run db:migrate:down` (006â†’009å›æ»šåˆ°005)
2. âœ… ä¿®æ”¹è„šæœ¬å¹¶ä¿å­˜
3. âœ… æ‰§è¡Œ `npm run db:migrate` (006-009å…¨é‡é‡æ–°æ‰§è¡Œ)
4. âœ… éªŒè¯: Job 72297 customer_name ä»ç©º â†’ "Bombardier"

### æ•°æ®éªŒè¯ç»“æœ

**è¿ç§»åæ•°æ®å®Œæ•´æ€§** (2025-01-11 14:30):
```
âœ… 339 jobs å®Œæ•´å¯¼å…¥
âœ… 172 purchase_orders (å«46ä¸ªä¸´æ—¶PO) âœ…
âœ… 358 order_items (å«customer+poå…³è”) âœ…
âœ… 1,657 parts (å«BOMæ ‘) âœ…
âœ… 1,460 part_tree relations (parent_idâ†’child_id) âœ…
âœ… 137,399 drawing_files (å«revision) âœ…
```

**ç‰¹éªŒè¯æ ·æœ¬**:
- Job 72297: po_id=317, contact_id=78 (Nesha), customer_id=30 (Bombardier) âœ…

---

## ğŸ“Š Sessions 1-6 æˆæœæ¦‚è§ˆ

### æ•°æ®åº“è¿ç§»ä¸æ‰«æç³»ç»Ÿ âœ…

| åŠŸèƒ½ | æˆæœ | é‡çº§ |
|------|------|------|
| ä¸šåŠ¡æ•°æ®è¿ç§» | 24 å®¢æˆ· + 339 ä½œä¸š + 358 è®¢å• | 100% |
| Gç›˜æ‰«æå¯¼å…¥ | PowerShell bug ä¿®å¤ + å…¨é‡æ‰«æ | 137,399 æ–‡ä»¶ |
| Assemblies è¿ç§» | ç¼ºå¤±é›¶ä»¶è¡¥å…¨ + BOM å…³ç³»å»ºç«‹ | 1,460 å…³ç³» |
| æ•°æ®åº“è¡¨ | 20 ä¸ªè¡¨ï¼Œ141,493 æ¡è®°å½• | âœ… |

### Session 5: API æ”¹å†™ (æœ¬session) ğŸš€

| ç±»åˆ« | APIæ•°é‡ | çŠ¶æ€ |
|------|--------|------|
| åŸºç¡€æŸ¥è¯¢ | 8ä¸ª | âœ… å®Œæˆ |
| å¤æ‚è”æŸ¥ | 3ä¸ª | âœ… å®Œæˆ |
| Partç®¡ç† | 2ä¸ª | âœ… å®Œæˆ |
| å…¶ä»–åŠŸèƒ½ | 3ä¸ª | âœ… å®Œæˆ |
| åˆ é™¤æ—§API | 4ä¸ª | âœ… å®Œæˆ |
| **åˆè®¡** | **20ä¸ª** | **âœ… 100%** |

---

## ğŸ’¾ æ•°æ®åº“çŠ¶æ€ (record.db)

**ä½ç½®**: data/record.db  
**å¤§å°**: ~500 KB  
**è¡¨æ•°**: 20 ä¸ª  
**æ€»è®°å½•**: 141,493 æ¡

### å·²åº”ç”¨è¿ç§» (9 ä¸ª)

```
âœ… 001_create_core_tables
âœ… 002_create_part_tables
âœ… 003_create_shipment_and_process_tables
âœ… 004_create_note_tables
âœ… 005_create_indices
âœ… 006_migrate_data_from_jobs_db
âœ… 007_import_drawing_files
âœ… 008_migrate_assemblies_to_part_tree
âœ… 009_add_revision_to_drawing_file
```

---

## ğŸ”‘ API æ”¹å†™è¯¦æƒ… (Session 5)

### âœ… ç¬¬ä¸€æ‰¹ï¼šåŸºç¡€æŸ¥è¯¢ (8ä¸ªAPI)

**Customers ç›¸å…³**ï¼š
- GET /api/customers â†’ `customer` è¡¨æŸ¥è¯¢
- GET/POST/PUT /api/customers/[id] â†’ `customer` è¡¨ CRUD
- PUT /api/customers/[id]/usage â†’ æ›´æ–°ä½¿ç”¨è®¡æ•°

**Contacts ç›¸å…³**ï¼š
- GET /api/contacts â†’ `customer_contact` è¡¨æŸ¥è¯¢ï¼ˆæ”¹ç”¨ customer_id è¿‡æ»¤ï¼‰
- GET/POST/PUT /api/contacts/[id] â†’ `customer_contact` è¡¨ CRUD
- PUT /api/contacts/[id]/usage â†’ æ›´æ–°ä½¿ç”¨è®¡æ•°

**Jobs ç›¸å…³**ï¼š
- GET /api/jobs â†’ è”æŸ¥ job + order_item + part + purchase_order + customer
- GET /api/jobs/next-numbers â†’ ä» job è¡¨è·å–ï¼Œæ”¹ä¸ºè¿”å› po_number

### âœ… ç¬¬äºŒæ‰¹ï¼šå¤æ‚è”æŸ¥ (3ä¸ªAPI)

- **POST /api/jobs/create** â†’ å®ç°å®Œæ•´æµç¨‹
  - customer â†’ purchase_order â†’ job â†’ order_item â†’ part
  - è‡ªåŠ¨åˆ›å»ºç¼ºå¤±çš„ PO å’Œ Part
  - æ›´æ–°å®¢æˆ·å’Œè”ç³»äººä½¿ç”¨è®¡æ•°

- **GET /api/jobs/search** â†’ å¤šè¡¨è”æŸ¥æœç´¢
  - job_number, po_number, drawing_number, customer_name
  - ä» job + order_item + part + customer_contact + customer è¡¨æœç´¢

- **GET /api/parts** ï¼ˆæ–°å»ºï¼‰
  - åŸ `/api/jobs/assemblies` é‡å‘½åå’Œè½®æ¢
  - æŸ¥è¯¢ part WHERE is_assembly=1

### âœ… ç¬¬ä¸‰æ‰¹ï¼šPartç®¡ç† (2ä¸ªAPI)

- **GET /api/parts** â†’ æŸ¥è¯¢ is_assembly=1 çš„é›¶ä»¶
- **PUT /api/parts/[id]** ï¼ˆæ–°å»ºï¼‰
  - åŸ `/api/jobs/assembly-detail-update` è½®æ¢
  - æ›´æ–° part è¡¨å­—æ®µ

### âœ… ç¬¬å››æ‰¹ï¼šå…¶ä»–åŠŸèƒ½ (3ä¸ªAPI)

- **GET /api/drawings/detail** â†’ ä» drawing_file è¡¨æŸ¥è¯¢
- **GET /api/jobs/drawing-file-location** â†’ ä» drawing_file è¡¨æ¨¡ç³ŠåŒ¹é…
- **GET /api/jobs/pdf** â†’ ä¿æŒä¸å˜ï¼ˆæ–‡ä»¶ç³»ç»Ÿæ“ä½œï¼‰

### ğŸ—‘ï¸ å·²åˆ é™¤çš„API

```
âœ… POST /api/jobs/assembly-detail-create (ä¸å®ç°åˆ›å»ºé€»è¾‘)
âœ… DELETE /api/jobs/assembly-detail-delete (ä¸å®ç°åˆ é™¤é€»è¾‘)
âœ… GET /api/jobs/assemblies (å·²è½®æ¢ä¸º /api/parts)
âœ… PUT /api/jobs/assembly-detail-update (å·²è½®æ¢ä¸º /api/parts/[id])
```

---

## ğŸ”„ è¡¨æ˜ å°„å…³ç³»ä¸å­—æ®µè½®æ¢

### Customers & Contacts

| æ—§è¡¨ | æ—§å­—æ®µ | æ–°è¡¨ | æ–°å­—æ®µ | å˜æ›´ |
|------|--------|------|--------|------|
| customers | customer_id | customer | id | å­—æ®µæ”¹å |
| - | is_active | - | - | åˆ é™¤ |
| - | customer_name | customer | customer_name | ä¿ç•™ |
| contacts | contact_id | customer_contact | id | å­—æ®µæ”¹å |
| - | customer_name | customer_contact | customer_id | æ”¹ä¸ºå…³è” |
| - | - | customer_contact | contact_email | æ–°å¢ |

### Jobs & Parts

| æ—§è¡¨ | æ—§ç»“æ„ | æ–°è¡¨ | æ–°ç»“æ„ | å˜æ›´ |
|------|--------|------|--------|------|
| jobs | å•è¡¨ | job + order_item + part | å¤šè¡¨ | è§„èŒƒåŒ–åˆ†è§£ |
| assembly_detail | - | part (is_assembly=1) | - | è½®æ¢ |
| detail_drawing | - | drawing_file | - | è½®æ¢ |
| drawings | - | drawing_file | - | è½®æ¢ |

---

## ğŸ› å…³é”®æ”¹å†™ç‚¹

### æ—¶é—´æˆ³å‡½æ•°
æ‰€æœ‰æ—¶é—´å­—æ®µä½¿ç”¨ï¼š
```sql
datetime('now', 'localtime')  -- æ›¿ä»£ CURRENT_TIMESTAMP
```

### å¤–é”®å…³è”
ä»ç›´æ¥åç§°å…³è”æ”¹ä¸º ID å…³è”ï¼š
```javascript
// æ—§: WHERE customer_name = ?
// æ–°: WHERE customer_id = ?
```

### å¤šæ­¥äº‹åŠ¡æµç¨‹
åˆ›å»ºä½œä¸šæ—¶æŒ‰åºï¼š
1. éªŒè¯/è·å– customer (by id)
2. è·å–/åˆ›å»º purchase_order
3. åˆ›å»º job
4. è·å–/åˆ›å»º part
5. åˆ›å»º order_item
6. æ›´æ–°ä½¿ç”¨è®¡æ•°

---

## ğŸ“‹ æŠ€æœ¯å†³ç­–

1. **è¡¨åè½®æ¢**: `customers` â†’ `customer`, `contacts` â†’ `customer_contact`
2. **IDå­—æ®µ**: ç»Ÿä¸€ä½¿ç”¨ `id` (è€Œé `customer_id`, `contact_id`)
3. **è¿‡æ»¤ç­–ç•¥**: æ”¹ç”¨ `customer_id` è€Œé `customer_name` (æ•°æ®å®Œæ•´æ€§)
4. **APIé‡å‘½å**: `/api/jobs/assemblies` â†’ `/api/parts` (RESTè§„èŒƒ)
5. **åˆ é™¤ç­–ç•¥**: ä¸å®ç° POST create å’Œ DELETE (å¿«é€Ÿè½åœ°)

---

## âš ï¸ é—ç•™é—®é¢˜

1. **æµ‹è¯•**: æœªè¿›è¡Œå•å…ƒæˆ–é›†æˆæµ‹è¯•ï¼ˆå¾…ä¸‹ä¸€sessionï¼‰
2. **PDF API**: ä»ä¾èµ– `file_location` å­—æ®µï¼ˆå¯è€ƒè™‘æ”¹è¿›ï¼‰
3. **æœç´¢API**: è¿”å›å­—æ®µéœ€ä¸UIå¯¹æ¥éªŒè¯
4. **é”™è¯¯å¤„ç†**: å¯å¢å¼ºäº‹åŠ¡å›æ»šæœºåˆ¶

---

## ğŸ¯ ä¸‹ä¸€æ­¥ä¼˜å…ˆçº§

1. **æµ‹è¯•API** - éªŒè¯å„æ¥å£åŠŸèƒ½æ­£ç¡®æ€§
2. **ä¿®å¤å‰ç«¯** - UI å¯¹æ¥æ–° API è¿”å›æ ¼å¼
3. **ä¼˜åŒ–æŸ¥è¯¢** - æ·»åŠ åˆ†é¡µã€è¿‡æ»¤ã€æ’åº
4. **å®Œå–„æ–‡æ¡£** - API ä½¿ç”¨æ‰‹å†Œæ›´æ–°

---

## ğŸ“Š Sessions 1-4 æˆæœæ¦‚è§ˆ

### æ•°æ®åº“è¿ç§»ä¸æ‰«æç³»ç»Ÿ âœ…

| åŠŸèƒ½ | æˆæœ | é‡çº§ |
|------|------|------|
| ä¸šåŠ¡æ•°æ®è¿ç§» | 24 å®¢æˆ· + 339 ä½œä¸š + 358 è®¢å• | 100% |
| Gç›˜æ‰«æå¯¼å…¥ | PowerShell bug ä¿®å¤ + å…¨é‡æ‰«æ | 137,399 æ–‡ä»¶ |
| Assemblies è¿ç§» | ç¼ºå¤±é›¶ä»¶è¡¥å…¨ + BOM å…³ç³»å»ºç«‹ | 1,460 å…³ç³» |
| æ•°æ®åº“è¡¨ | 20 ä¸ªè¡¨ï¼Œ141,493 æ¡è®°å½• | âœ… |

### å…³é”®ç»Ÿè®¡

```
å·²å¡«å……è¡¨ (9 ä¸ª)
- customer: 24
- customer_contact: 69
- purchase_order: 172
- job: 339
- order_item: 358
- part: 1,657
- part_tree: 1,460
- drawing_file: 137,399
- shipment/item: 5/10
```

---

## ğŸ’¾ æ•°æ®åº“çŠ¶æ€ (record.db)

**ä½ç½®**: data/record.db  
**å¤§å°**: ~500 KB  
**è¡¨æ•°**: 20 ä¸ª  
**æ€»è®°å½•**: 141,493 æ¡

### å·²åº”ç”¨è¿ç§» (9 ä¸ª)

```
âœ… 001_create_core_tables
âœ… 002_create_part_tables
âœ… 003_create_shipment_and_process_tables
âœ… 004_create_note_tables
âœ… 005_create_indices
âœ… 006_migrate_data_from_jobs_db
âœ… 007_import_drawing_files
âœ… 008_migrate_assemblies_to_part_tree
âœ… 009_add_revision_to_drawing_file
```

---

## ğŸ”‘ å…³é”®æŠ€æœ¯å†³ç­–

1. **Gç›˜æ‰«ææ¶æ„**: Node.js ç¼–æ’ + PowerShell Worker (4çº¿ç¨‹)
2. **æ—¶é—´æˆ³æ ¼å¼**: æœ¬åœ°æ—¶é—´ "YYYY-MM-DD HH:MM:SS" (UTC-05:00)
3. **è½¯åˆ é™¤**: is_active æ ‡å¿—è€Œéç¡¬åˆ é™¤
4. **part_id å¯ä¸ºç©º**: drawing_file åæœŸæ‰‹å·¥åŒ¹é…

---

## ğŸ› é‡è¦ä¿®å¤

### Session 3: PowerShell Bug Fix
- **é—®é¢˜**: æ‰«ææ–‡ä»¶ç¼ºå¤± (49% è¦†ç›–ç‡)
- **åŸå› **: return è¯­å¥å¯¼è‡´å‡½æ•°æå‰é€€å‡º
- **ä¿®å¤**: return â†’ continue
- **ç»“æœ**: æ–‡ä»¶æ•°ä» 78,544 â†’ 137,399 (100% è¦†ç›–)

---

## ğŸ“ Session 4 æ–‡æ¡£ä¸æ•°æ®åº“è®¾è®¡è§„èŒƒåŒ–

### å®Œæˆå·¥ä½œ
- âœ… ä¿®å¤ check-db.js (æ”¯æŒ record.db)
- âœ… åˆ›å»º structure.txt (å®Œæ•´æ•°æ®åº“æ–‡æ¡£)
- âœ… è°ƒæ•´ refactor.md (åæ˜ å®é™…æ•°æ®çŠ¶æ€)
- âœ… **æ‰€æœ‰CREATE TABLEæ ¼å¼åŒ–** (Tabå¯¹é½+è¯¦ç»†æ³¨é‡Š)
- âœ… **é€šç”¨noteè¡¨æ‹†åˆ†ä¸º6ä¸ªç‹¬ç«‹è¡¨** (po/job/order_item/part/shipment/attachment_note)
- âœ… æ›´æ–° updates.json

### ä»£ç è§„èŒƒç¡®ç«‹
æ‰€æœ‰CREATE TABLEé‡‡ç”¨ç»Ÿä¸€æ ¼å¼ï¼š
```sql
CREATE TABLE xxx (
	å­—æ®µå				ç±»å‹		çº¦æŸ,				-- å­—æ®µè¯´æ˜
	å…³è”å­—æ®µ			ç±»å‹		NOT NULL,			-- å…³è”è¯´æ˜
	...
	
	-- å¤–é”®çº¦æŸ
	FOREIGN KEY (field)		REFERENCES other_table(id)	ON DELETE CASCADE
);
```

### Noteè¡¨æ‹†åˆ†
æ—§ï¼šé€šç”¨ note è¡¨ï¼ˆå¤šç»´å…³è”ï¼‰
æ–°ï¼š6 ä¸ªç‹¬ç«‹è¡¨ï¼ˆå•ä¸€èŒè´£ï¼‰
- po_note: é‡‡è´­è®¢å•å¤‡æ³¨
- job_note: ä½œä¸šå¤‡æ³¨  
- order_item_note: è®¢å•æ˜ç»†å¤‡æ³¨
- part_note: é›¶ä»¶å¤‡æ³¨
- shipment_note: å‘è´§å•å¤‡æ³¨
- attachment_note: é™„ä»¶å¤‡æ³¨

---

## ğŸš€ å¿«é€Ÿå‘½ä»¤

```bash
# æ£€æŸ¥æ•°æ®åº“
node scripts/check-db.js

# è¿ç§»çŠ¶æ€
npm run db:migrate:status

# è¿ç§»åº”ç”¨
npm run db:migrate
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥ä¼˜å…ˆçº§

1. **API å¼€å‘** - æ„å»ºæ•°æ®æŸ¥è¯¢æ¥å£
2. **UI ç»„ä»¶** - å±•ç¤ºå›¾çº¸æ–‡ä»¶åˆ—è¡¨
3. **æ–‡ä»¶åŒ¹é…** - è‡ªåŠ¨/æ‰‹å·¥åŒ¹é… drawing_file â†” part
4. **ç”Ÿäº§è¿½è¸ª** - å·¥è‰ºæ¨¡æ¿å’Œæ­¥éª¤è®°å½•

---

**ç³»ç»Ÿå°±ç»ªåº¦**: ğŸŸ¢ 100% (æ•°æ®åº“å®Œå…¨å°±ç»ª)  
**è®¾è®¡è§„èŒƒ**: ğŸŸ¢ 100% (refactor.md è§„èŒƒåŒ–å®Œæˆ)  
**ä¸‹ä¸€äº¤æ¥**: API è·¯ç”±å®ç°

---

## ğŸ“ Session 12: OEæ•°æ®åŒæ­¥è„šæœ¬æ”¹è¿›ä¸æ•°æ®è´¨é‡ä¿®å¤

**æ—¶é—´**: 2026-01-27  
**çŠ¶æ€**: ğŸ”´ **è¿›è¡Œä¸­ - éœ€è¦ä¸‹ä¸ªSessionå®Œæˆ**

### é—®é¢˜åˆ†æ

#### ğŸ› å‘ç°çš„æ•°æ®è´¨é‡é—®é¢˜

1. **Unit Price å…¨ä¸º0**
   - æ–°æ’å…¥çš„226ä¸ªpart (2026-01-27)ï¼Œunit_priceå…¨éƒ¨ä¸º0
   - åŸå› ï¼š`insertNewOrderItem`ä¸­æ²¡æœ‰ä»OEæ•°æ®è¯»å–priceå­—æ®µ
   - åº”è¯¥å€¼ï¼šä»OEè¡¨ä¸­çš„priceåˆ—è·å–

2. **Order Itemæ—¥æœŸä¸ºNULL**
   - order_itemä»359å¼€å§‹çš„è®°å½•ï¼Œdrawing_release_dateå’Œdelivery_required_dateå…¨ä¸ºNULL
   - åŸå› ï¼šnormalizeDateå‡½æ•°æœªèƒ½æ­£ç¡®å¤„ç†OEä¸­çš„æ—¥æœŸæ ¼å¼
   - éœ€è¦ï¼šè°ƒæŸ¥OEæ–‡ä»¶ä¸­å®é™…çš„æ—¥æœŸæ ¼å¼ï¼Œä¿®å¤è½¬æ¢é€»è¾‘

3. **Purchase Order æ•°æ®åŒæ­¥ä¸å®Œæ•´**
   - æ•°æ®åº“ä¸­åªæœ‰236ä¸ªactive POï¼Œä½†OEæ–‡ä»¶æœ‰350è¡Œæ•°æ®
   - æ•°æ®åº“ç»Ÿè®¡ï¼š274æ€»PO, 236 active, 38 inactive
   - OEæ–‡ä»¶å”¯ä¸€OEå·: 169ä¸ª (ä½†æœ‰350è¡Œæ•°æ®)
   - åŸå› å¾…æŸ¥ï¼šå¯èƒ½æ˜¯ä¸€ä¸ªOEæœ‰å¤šä¸ªJob/Lineï¼Œå¯¼è‡´å¤šæ¡order_itemå…±äº«åŒä¸€ä¸ªPO

### å½“å‰æ•°æ®åº“çŠ¶æ€

```
purchase_order:  274æ€», 236 active, 38 inactive
order_item:      425æ¡ (é¢„æœŸåº”è¯¥æ¥è¿‘350)
job:             391æ¡
part:            1894æ¡ (å…¶ä¸­1603æ¡unit_price=0)
```

### å·²å®Œæˆçš„ä¿®å¤

âœ… **ä¿®å¤const/leté”™è¯¯**
- findOrderItem: const query â†’ let query
- syncDatabase: const markedInactiveOes â†’ let markedInactiveOes

âœ… **ä¿®å¤æ–‡ä»¶è·¯å¾„**
- Excelè·¯å¾„: `data/Order Entry Log.xlsm` â†’ `src/order entry log/Order Entry Log.xlsm`

âœ… **æ·»åŠ UNIQUEçº¦æŸé¢„æ£€æŸ¥**
- insertNewOrderItemä¸­æ·»åŠ pre-check: (job_id, line_number)
- å¦‚æœå·²å­˜åœ¨ï¼Œè¿”å›ç°æœ‰IDè€Œéé‡å¤æ’å…¥

### éœ€è¦åœ¨ä¸‹ä¸ªSessionå®Œæˆçš„å·¥ä½œ

#### TODO #1: ä¿®å¤ `insertNewOrderItem` çš„unit_priceå¡«å……
**ä¼˜å…ˆçº§**: ğŸ”´ é«˜

åœ¨insertNewOrderItemå‡½æ•°ä¸­ï¼š
1. ä»rowData.priceï¼ˆOEæ•°æ®ï¼‰è¯»å–unit_price
2. åœ¨insertPartæ—¶å¡«å……unit_priceï¼ˆä¸èƒ½ä¸º0ï¼‰
3. åŒæ—¶æ›´æ–°order_item.actual_price

**æ”¹åŠ¨ç‚¹**: 
- è¡Œ308-330: insertPartéƒ¨åˆ†éœ€è¦å¢åŠ unit_priceå‚æ•°
- è¡Œ380-410: partè¡¨çš„INSERTéœ€è¦åŒ…å«unit_price

#### TODO #2: ä¿®å¤order_itemæ—¥æœŸå¤„ç†
**ä¼˜å…ˆçº§**: ğŸ”´ é«˜

1. æ£€æŸ¥OEæ–‡ä»¶(åˆ—å·?)ä¸­æ—¥æœŸçš„å®é™…æ ¼å¼
2. æ”¹è¿›normalizeDateå‡½æ•°å¤„ç†å¤šç§æ ¼å¼
3. ç¡®ä¿drawing_release_dateå’Œdelivery_required_dateæ­£ç¡®å¡«å……

**æ”¹åŠ¨ç‚¹**:
- è¡Œ475-495: normalizeDateå‡½æ•°éœ€è¦å¢å¼º
- è¡Œ449-451: INSERTè¯­å¥ç¡®ä¿æ—¥æœŸå‚æ•°æ­£ç¡®

#### TODO #3: æ’æŸ¥POæ•°æ®åŒæ­¥é€»è¾‘
**ä¼˜å…ˆçº§**: ğŸŸ¡ ä¸­

éœ€è¦ç†è§£ä¸ºä»€ä¹ˆ236ä¸ªactive PO < 350è¡ŒOEæ•°æ®ï¼š
1. å¯èƒ½æ˜¯1ä¸ªPOå¯¹åº”å¤šä¸ªJob
2. éœ€è¦éªŒè¯OEæ–‡ä»¶ä¸­æ˜¯å¦æœ‰é‡å¤çš„POå·
3. ç¡®è®¤update-oe-database.jsä¸­POåˆ›å»º/æŸ¥æ‰¾çš„é€»è¾‘

**æ”¹åŠ¨ç‚¹**:
- è¡Œ333-380: findOrCreatePurchaseOrderé€»è¾‘å®¡æŸ¥
- éœ€è¦ä¸OEæ–‡ä»¶ç»“æ„å¯¹åº”

### å…³é”®ä»£ç ä½ç½®

| å‡½æ•° | ä½ç½® | ä½œç”¨ | çŠ¶æ€ |
|------|------|------|------|
| insertNewOrderItem | 307-487 | æ ¸å¿ƒçº§è”æ’å…¥ | ğŸ”´ éœ€æ”¹è¿› |
| insertPart | 360-410 | Partè¡¨æ’å…¥ | ğŸ”´ ç¼ºunit_price |
| normalizeDate | 475-495 | æ—¥æœŸæ ¼å¼è½¬æ¢ | ğŸ”´ éœ€æ”¹è¿› |
| findOrCreatePurchaseOrder | 333-380 | POæŸ¥æ‰¾/åˆ›å»º | ğŸŸ¡ éœ€å®¡æŸ¥ |
| syncDatabase | 630-750 | ä¸»äº‹åŠ¡æµç¨‹ | âœ… åŸºæœ¬æ­£ç¡® |

### ä¿®å¤ç­–ç•¥

**ä¸åˆ›å»ºè¿ç§»è„šæœ¬** - ç›´æ¥åœ¨update-oe-database.jsä¸­ä¿®å¤ï¼ˆä¸€æ¬¡æ€§è„šæœ¬ï¼‰

**ä¿®æ”¹é¡ºåº**:
1. å…ˆä¿®å¤unit_priceï¼ˆæœ€ç›´æ¥ï¼‰
2. å†ä¿®å¤æ—¥æœŸå¤„ç†
3. æœ€åéªŒè¯POé€»è¾‘

**éªŒè¯æ–¹å¼**:
- é‡æ–°è¿è¡Œ: `node scripts/update-oe-database.js`
- æ£€æŸ¥output: 348 inserted + 2 matched = 350 total âœ“
- éªŒè¯æ•°æ®åº“:
  - part.unit_price > 0çš„æ•°é‡åº”è¯¥å¢åŠ 
  - order_itemæ—¥æœŸåº”è¯¥ä¸ä¸ºNULL
  - purchase_orderåº”è¯¥æœ‰350ä¸ªå¯¹åº”çš„è®°å½•

### å½“å‰ä»£ç é—®é¢˜æ€»ç»“

**insertNewOrderItemé—®é¢˜**:
```javascript
// ç¬¬360-410è¡Œçš„insertPartç¼ºå°‘unit_price
const insertPartStmt = db.prepare(`
  INSERT INTO part (drawing_number, revision, description, created_at, updated_at)
  VALUES (?, ?, ?, datetime('now', 'localtime'), datetime('now', 'localtime'))
`);
// âŒ ç¼ºå°‘: unit_priceå‚æ•°
```

**normalizeDateé—®é¢˜**:
```javascript
// ç¬¬475-495è¡Œåªèƒ½å¤„ç†åŸºç¡€æ ¼å¼
function normalizeDate(dateStr) {
  if (/^\d{4}-\d{2}-\d{2}$/.test(dateStr)) {
    return dateStr;
  }
  // âŒ å¯èƒ½æ²¡æœ‰å¤„ç†OEä¸­çš„æ—¥æœŸæ ¼å¼ï¼ˆå¦‚excel date numberç­‰ï¼‰
}
```

### ä¸‹ä¸ªSessionæ£€æŸ¥æ¸…å•

- [ ] ç¡®è®¤OEæ–‡ä»¶ä¸­priceåˆ—çš„ä½ç½®(column?)
- [ ] ç¡®è®¤OEæ–‡ä»¶ä¸­æ—¥æœŸåˆ—çš„ä½ç½®å’Œæ ¼å¼
- [ ] ä¿®æ”¹insertPartæ·»åŠ unit_priceå‚æ•°
- [ ] æ”¹è¿›normalizeDateå‡½æ•°
- [ ] é‡æ–°è¿è¡Œè„šæœ¬å¹¶éªŒè¯ç»“æœ
- [ ] æ›´æ–°update-oe-database.jsä½¿å…¶æˆä¸ºæœ€ç»ˆç‰ˆæœ¬


