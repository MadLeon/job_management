jobs数据库是老数据库, 存放在data/jobs.database
mp schedule以jobs作为数据来源进行编写
现在对数据库进行了重构, 新数据库是record.db, 存放在data/record.db
迁移的逻辑可以在scripts/migration进行查看
现在希望将旧有的excel表格按照新数据的结构进行修改

mp schedule excel file 的业务逻辑是
一个Sync All按钮触发SyncAll函数
一个Gen Links触发CreateHyperLinks函数

mp schedule excel file 的列为:
- order item id: 对应数据库中 order_item id
- PO #
- JOB #
- Customer
- Description
- Part #
- Qty.
- Ship Date: 对应 Delivery required date

mp schedule excel file 中数据的组织形式是 order item 行 + detail part 行
- order item 行的特征为: 第二列 job #, 第三列 po #, 第四列 customer 均有值
- detail part 行的特征为: 前四列均为空
- order item 下可以不包含 detail part
- detail part 与 order item 形成多对一的关系
- 一个 order item 被删除, 其下方的所有 detail part 也应该同时被移除, 此处类似 excel 中的行删除操作


SyncAll函数较为复杂, 且之前的逻辑可能有漏洞, 因为最近几次无法正常使用, 无法添加所有的order item
目前我希望修改总体业务逻辑, 
- 舍弃shipped表格, 不在需要track已经不在oe entry文件中的条目
- 添加几列字段, 让mp schedule有更多的信息

先阅读上个session的记忆
本session主要任务:
1. 分析当前文件帮助我回想当时的逻辑
2. 重写SyncALL函数
先制定todos, 并在todos的每一步暂停, 由我来核对, 获得许可后方能继续执行

在session结束时, 请使用中文总结当前session的内容, 尽量简短, 格式如下:
总结本session主要任务 (一句话)
本session todos包括 (简单bullet points)
操作及变更细节 (简单bullet points)
未来注意 (一句话)
将该总结并入 mp schedule/summary.md, 尽量简短, 如果没有该文件则创建

本session主要任务:
手动更新 MP Schedule 的第一列的 order item id
先给出你对于数据库字段与oe文件列的关联的理解, 我需要确认你的理解是正确的
我们需要制定一个方案, 使得文件中每行可以在数据库中找到其对应的条目.
先制定todos, 并在todos的每一步暂停, 由我来核对, 获得许可后方能继续执行

本session主要任务:
添加新 .bas 文件, 一个新的模块 (帮我命名), 用于同步 priority sheet 与数据库 record.db 中的数据
priority sheet的结构:
- 多个order item行搭配下方的零件行, 其中零件行可能不存在
- order item行的特征是: 前两列有值. 首列的值为order_item表的ID属性, 次列的值为job#
- 零建行的前三列均为空

该模块的逻辑:
首先进行清除操作, 所有首列的order item id, 只要其不在数据库, 就移除该order item行以及其下方的所有零件行
然后进行增量操作
- 找到 priority sheet 的最后一个被编辑的A列的值, 记录该值 (debug print该值)
- 在数据库的order item表找到所有大于该id的记录
- 将这些记录添加到该工作表的下面 (插入时仅考虑order item行)
- 插入时, order item行之间应间隔一行 (第一个插入行与之前最后一行间也应间隔一行)

注意: 移除时, order item与其下方的零件行被视为一体, 移除的范围应该是order item行下方直到找到下一个order item行, 或者直到本sheet的最后一行 (若始终未找到下一个order item)




formatPrioritySheet 重写
- 根据新的 Priority Sheet 重写格式化内容

SyncAll 顺序调用新模块 & formatPrioritySheet

Gen Links 的逻辑 (已完成)
- 点击按钮, 触发函数
- 筛选出选区内所有的E列的数据, 对每一个E列数据进行遍历
  - 使用 drawing_number 查找 part_id
    - 若找到, 则使用 part_id 在 drawing_file 中进行查找
      - 找到结果则直接返回 (最佳情况)
      - 未找到则进行模糊匹配
    - 未找到则进行模糊匹配

模糊匹配 (直接使用 drawing_number 在 drawing_file 表中进行查找)
- 匹配失败
  - 直接返回, 什么都不做
- 找到结果 (一个或多个)
  - 记录所有找到的结果
  - 如果找到的结果中有且仅有一条记录的is_active=1
    - 返回结果
  - else
    - 检查所有的 file_path 是否包含当前的 PO
      - 匹配成功
        - 返回成功的所有结果中 last_modified 最新的那个
      - 匹配失败
        - 返回 last_modified 最新的那个


