# 📋 提案评审清单

请按照以下清单逐项评审提案，并在相应位置标记你的意见。

---

## 📄 文档清单

### 你需要阅读的文档（按优先级）

#### 1️⃣ 必读（决策相关）
- [ ] **[README.md](./README.md)** - 5-10 分钟
  - 快速概览提案要点
  - 问题分析与解决方案
  - 工作计划与关键问题
  
#### 2️⃣ 重要（细节确认）
- [ ] **[proposal.md](./proposal.md)** - 20-30 分钟
  - 完整的表结构设计（15 个表）
  - 所有表的 SQL 创建语句
  - 关键改进点总结
  - 符合三范式的验证

#### 3️⃣ 参考（深入理解）
- [ ] **[comparison.md](./comparison.md)** - 15-20 分钟
  - 旧新设计对比
  - 详细的字段映射
  - 数据迁移策略建议
  
#### 4️⃣ 执行参考（实施阶段）
- [ ] **[design.md](./design.md)** - 开发人员读
  - 详细的数据库设计
  - 每个表的字段说明和业务含义
  - 约束、索引、验证规则
  
- [ ] **[tasks.md](./tasks.md)** - 项目管理用
  - 7 个阶段的具体工作项
  - 优先级和依赖关系
  - 工作量估算和验收标准

---

## ✅ 提案评审要点

### 第 1 部分: 数据库设计评审

#### 1.1 表结构与字段定义
```
□ 是否同意 15 个新表的设计？
  ✅ 是，完全同意
  □ 大部分同意，需要调整某些表
  □ 不同意，需要重新设计
  
  如果需要调整，请指出：
  _________________________________________________________________
  _________________________________________________________________
```

#### 1.2 外键约束与级联删除
```
□ 是否同意完整的外键约束（ON DELETE CASCADE）？
  ✅ 是，确保数据完整性是必需的
  □ 有顾虑，需要讨论某些级联策略
  
  具体顾虑（如有）：
  _________________________________________________________________
```

#### 1.3 唯一约束与业务逻辑
```
□ 是否认同以下唯一约束的设计？
  □ customer.customer_name
  □ purchase_order.po_number
  □ job.job_number
  □ part.drawing_number + revision
  □ order_item.job_id + line_number
  
  是否需要调整某些约束？
  同意
```

#### 1.4 新增表的必要性
```
□ 以下新增表是否对应实际业务需求？
  
  【核心实体】
  ✓ customer - 客户主表 ✓ 必需 ✗ 可考虑移除
  ✓ customer_contact - 联系人表 ✓ 必需 ✗ 可考虑移除
  ✓ purchase_order - 采购订单表 ✓ 必需 ✗ 可考虑移除
  
  【生产管理】
  ✓ part_tree - BOM 表 ✓ 必需 ✗ 可延后实现
  ✓ process_template - 工艺模板 ✓ 必需 ✗ 可延后实现
  ✓ step_tracker - 步骤追踪 ✓ 必需 ✗ 可延后实现
  
  【附件与备注】
  ✓ part_attachment - 零件附件 ✓ 必需 ✗ 可延后实现
  ✓ note - 通用备注 ✓ 必需 ✗ 可延后实现
  
  如有延后表，请注明：
  _________________________________________________________________
```

#### 1.5 字段设计与数据类型
```
□ 是否同意所有字段的类型和约束设计？
  ✓ 是，设计合理
  □ 有改进建议
  
  改进建议：
  _________________________________________________________________
  _________________________________________________________________
```

---

### 第 2 部分: 数据迁移评审

#### 2.1 旧数据保留策略
```
关键问题 1: 旧的 358 条 jobs 记录如何处理？

□ 选项 A: 完全迁移到新数据库
  [优点] 完整的数据历史，无损迁移
  [缺点] 需要详细的 ETL 脚本，工作量较大

□ 选项 B: 保留旧库用于参考，新库从零开始
  [优点] 新库清洁，快速部署
  [缺点] 丢失历史数据，需要并行维护两个库

□ 选项 C: 有选择地迁移（如只迁移最近 6 个月）
  [优点] 平衡历史数据和系统简洁性
  [缺点] 需要定义迁移条件

  你的选择: □ A  ✓ B  □ C
  
  理由：
  _________________________________________________________________
```

#### 2.2 数据验证与质量保证
```
□ 迁移后数据验证策略是否充分？
  ✓ 是，提案中的验证清单可行
  □ 需要补充额外的验证步骤
  
  补充需求（如有）：
  _________________________________________________________________
```

#### 2.3 回滚与风险管理
```
□ 是否同意"保留旧库备份"的风险缓解方案？
  □ 是，这是必需的
  ✓ 有其他建议
  
  其他建议：
  我已手动备份过, 仅将现有jobs.db作为数据源生产出新的数据库即可, 但是应该保证该过程可以被复用, 即未来如果存在相同结构不同数据的jobs.db数据库, 使用db:migration可以完成数据迁移操作
```

---

### 第 3 部分: 应用改造评审

#### 3.1 改造范围与优先级
```
关键问题 2: 应用改造的优先级如何安排？

【推荐的优先级顺序】
1. 客户和联系人 API (4.2)
2. 订单和作业 API (4.3)
3. 订单明细和零件 API (4.4)
4. 生产追踪 API (4.5)
5. 发货管理 API (4.6)
6. 附件和备注 API (4.7)

✓ 同意该优先级
□ 需要调整优先级

调整方案（如需要）：
注意在api生成的过程中, 要确保使用jest生成test case并验证通过. 
```

#### 3.2 前端改造范围
```
□ 前端改造的 6 个主要页面是否足够？
  ✓ 是，覆盖了所有关键功能
  □ 遗漏了某些重要页面
  
  遗漏的页面（如有）：
  _________________________________________________________________
```

#### 3.3 测试与验证
```
□ 测试计划是否充分？
  ✓ 是，3 个测试层级（DB、API、前端）覆盖全面
  □ 需要补充性能测试或其他测试
  
  补充需求：
  _________________________________________________________________
```

---

### 第 4 部分: 时间与资源评估

#### 4.1 工作量评估
```
关键问题 3: 预期上线时间是什么？

总工作量估算: 96-127 小时 ≈ 2-3 周（单人）

□ 时间表能否接受？
  □ 是，2-3 周内上线
  □ 需要更快，可并行加人
  ✓ 可以延后，优先保证质量
  
  你的预期：
  - 最早上线时间: _____________
  - 最晚容忍时间: _____________
  - 推荐方案: □ 快速上线 ✓ 精品质量 □ 平衡考虑
```

#### 4.2 资源需求
```
□ 是否有足够的资源投入？
  ✓ 是，1 人专职即可
  □ 需要 2 人团队提速
  □ 需要额外的 QA 或测试
  
  可用资源：
  _________________________________________________________________
```

---

### 第 5 部分: 业务需求确认

#### 5.1 新增功能是否符合需求？
```
□ BOM 管理 (part_tree)
  □ 当前需要 ✓ 未来需要 □ 不需要

□ 生产步骤追踪 (step_tracker)
  □ 当前需要 ✓ 未来需要 □ 不需要

□ 附件管理 (part_attachment, drawing_file)
  □ 当前需要 ✓ 未来需要 □ 不需要

□ 备注系统 (note)
  □ 当前需要 ✓ 未来需要 □ 不需要

□ 使用统计 (customer.usage_count, last_used)
  ✓ 当前需要 □ 未来需要 □ 不需要

哪些功能可以延后实现（降低风险和工作量）？
在需要选择用户和联系人时, 按现有逻辑类似的逻辑实现排序
```

#### 5.2 业务规则与流程
```
□ 以下业务规则是否正确理解？

【采购订单与订单明细关系】
  一个采购订单 (purchase_order) 可以有多个作业 (job)
  一个作业可以有多个订单明细 (order_item，按行号区分)
  
  ✓ 理解正确 □ 需要调整 □ 有其他规则

【零件版本管理】
  同一图纸号 (drawing_number) 的不同版本 (revision) 是不同的 part 记录
  通过 previous_id 形成版本链
  
  □ 理解正确 ✓ 需要调整 □ 需要不同的版本策略
  基本理解正确, 但是现在追加了next_id双向追踪, 查看design_feedback获取具体信息

【生产步骤与发货】
  生产步骤追踪 (step_tracker) 按照工艺模板 (process_template) 进行
  发货 (shipment) 关联到订单明细 (order_item)，可分批发货
  
  ✓ 理解正确 □ 需要调整
  
【使用统计】
  每次创建/编辑订单时，自动更新相关客户和联系人的 usage_count 和 last_used
  
  □ 理解正确 ✓ 需要调整
  基本正确, 仅需注意在每次客户和联系人被使用时更新相关逻辑
```

---

## 🎯 最终决策

### 总体评价

```
综合评分（请选择）：

□ ⭐⭐⭐⭐⭐ (5/5) 完全同意，可立即开始执行
✓ ⭐⭐⭐⭐ (4/5) 基本同意，有少量调整需求
□ ⭐⭐⭐ (3/5) 同意方向，需要重要调整
□ ⭐⭐ (2/5) 有较多顾虑，需要深入讨论
□ ⭐ (1/5) 不同意，需要重新设计

总体意见：
_________________________________________________________________
_________________________________________________________________
_________________________________________________________________
```

### 同意/不同意声明

```
基于上述评审，我：

✓ 同意该数据库规范化重构方案，授权开始执行
  - 预期上线时间: _____________
  - 关键依赖事项: _____________________________________________
  - 其他附加条件: 需要注意, 在你进行操作时, 同时删除structure.txt并建立structure.md将新的数据库结构写入其中, 要求对每一个表和column进行注释, 以便更好理解

□ 有保留意见，需要以下调整后方可同意：
  1. _________________________________________________________________
  2. _________________________________________________________________
  3. _________________________________________________________________
  
  何时可以调整后重新评审？ _____________

□ 不同意该方案，原因如下：
  _________________________________________________________________
  _________________________________________________________________
  
  建议方向: _________________________________________________________________
```

### 下一步行动

```
如果评审通过，请确认以下行动：

[ ] 1. 我将在 _____________ 前完成详细的数据迁移计划
[ ] 2. 我将提供旧数据库的结构文档和样本数据（如需迁移）
[ ] 3. 我将确认应用改造的功能优先级排序
[ ] 4. 我将提供测试用例的需求文档
[ ] 5. 我将确认生产部署的时间窗口

签署人: _________________  日期: _________________
```

---

## 📞 评审完成后的行动

### 如果同意 ✅
1. 开始 **阶段 2: 数据库初始化**
   - 删除旧迁移脚本
   - 创建新迁移脚本
   - 执行 `npm run db:migrate`

2. 根据优先级开始 **阶段 4 & 5: 应用改造**

3. 定期同步进度，收集反馈

### 如果需要调整 ⚠️
1. 我会更新提案文档
2. 再次提交评审
3. 确认无异议后开始执行

### 如果不同意 ❌
1. 我们深入讨论替代方案
2. 制定改进的数据库设计
3. 重新评审

---

**评审状态**: ⏳ 等待你的反馈  
**创建时间**: 2025-01-06  
**预期反馈时间**: _______________  

感谢你的详细评审！
